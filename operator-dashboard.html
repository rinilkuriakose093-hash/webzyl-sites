<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Operator Dashboard - Webzyl</title>
  
  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700;800&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">
  
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  
  <!-- ImageKit -->
  <script src="https://unpkg.com/imagekit-javascript/dist/imagekit.min.js"></script>
  
  <style>
    :root {
      --color-primary: #0891b2;
      --color-primary-light: #06b6d4;
      --color-accent: #f59e0b;
      --color-success: #10b981;
      --color-warning: #f59e0b;
      --color-danger: #ef4444;
      --color-bg: #0f172a;
      --color-bg-light: #1e293b;
      --color-bg-card: #1e293b;
      --color-text: #f1f5f9;
      --color-text-muted: #94a3b8;
      --color-border: #334155;
      --font-main: 'Outfit', sans-serif;
      --font-mono: 'JetBrains Mono', monospace;
      --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.3);
      --shadow-md: 0 4px 16px rgba(0, 0, 0, 0.4);
      --shadow-lg: 0 8px 32px rgba(0, 0, 0, 0.5);
      --radius-sm: 8px;
      --radius-md: 12px;
      --radius-lg: 16px;
      --radius-xl: 24px;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: var(--font-main);
      background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
      color: var(--color-text);
      min-height: 100vh;
      line-height: 1.6;
    }

    /* Hero desktop cropper (Facebook-like focal point) */
    .hero-cropper {
      width: 100%;
      max-width: 900px;
      aspect-ratio: 16 / 9;
      border-radius: 14px;
      border: 1px solid var(--color-border);
      background-color: rgba(255,255,255,0.06);
      background-position: 50% 50%;
      background-size: cover;
      background-repeat: no-repeat;
      box-shadow: var(--shadow-sm);
      position: relative;
      overflow: hidden;
      cursor: grab;
      user-select: none;
      touch-action: none;
    }
    .hero-cropper.dragging { cursor: grabbing; }
    .hero-cropper::after {
      content: 'Drag to reposition (Desktop crop preview)';
      position: absolute;
      left: 12px;
      bottom: 12px;
      padding: 6px 10px;
      font-size: 0.85rem;
      color: rgba(255,255,255,0.92);
      background: rgba(0,0,0,0.35);
      border: 1px solid rgba(255,255,255,0.18);
      border-radius: 10px;
      backdrop-filter: blur(6px);
      -webkit-backdrop-filter: blur(6px);
    }
    .hero-cropper-controls {
      display: grid;
      gap: 0.75rem;
      margin-top: 0.75rem;
      max-width: 900px;
    }
    .hero-cropper-row {
      display: grid;
      grid-template-columns: 120px 1fr 64px;
      align-items: center;
      gap: 0.75rem;
      color: var(--color-text-muted);
      font-size: 0.9rem;
    }
    .hero-cropper-row input[type="range"] {
      width: 100%;
    }
    .hero-cropper-actions {
      display: flex;
      gap: 0.75rem;
      align-items: center;
      margin-top: 0.25rem;
    }

    .hero-cropper-wrapper[hidden] {
      display: none !important;
    }

    /* Hero text/buttons positioner */
    .hero-textpos {
      width: 100%;
      max-width: 900px;
      border-radius: 14px;
      border: 1px solid var(--color-border);
      background-color: rgba(255,255,255,0.06);
      box-shadow: var(--shadow-sm);
      position: relative;
      overflow: hidden;
      user-select: none;
      touch-action: none;
    }
    .hero-textpos.desktop { aspect-ratio: 16 / 9; }
    .hero-textpos.mobile { aspect-ratio: 9 / 16; max-width: 420px; }
    .hero-textpos-bg {
      position: absolute;
      inset: 0;
      background-position: 50% 50%;
      background-size: cover;
      background-repeat: no-repeat;
      filter: saturate(1.05);
    }
    .hero-textpos-dim {
      position: absolute;
      inset: 0;
      background: linear-gradient(180deg, rgba(0,0,0,0.22) 0%, rgba(0,0,0,0.28) 55%, rgba(0,0,0,0.22) 100%);
    }
    .hero-textpos-item {
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      min-width: 180px;
      max-width: min(86%, 560px);
      padding: 12px 14px;
      border-radius: 16px;
      background: rgba(0,0,0,0.30);
      border: 1px solid rgba(255,255,255,0.22);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      color: rgba(255,255,255,0.95);
      cursor: grab;
      box-shadow: 0 18px 50px rgba(0,0,0,0.35);
      user-select: none;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .hero-textpos-item.dragging { cursor: grabbing; }
    .hero-textpos-item.headline { font-weight: 900; font-size: 18px; }
    .hero-textpos-item.tagline { top: 58%; font-weight: 700; font-size: 13px; opacity: 0.92; }

    .hero-textpos-wa {
      position: absolute;
      left: 92%;
      top: 88%;
      transform: translate(-50%, -50%);
      width: 54px;
      height: 54px;
      border-radius: 999px;
      background: rgba(37, 211, 102, 0.85);
      border: 1px solid rgba(255,255,255,0.22);
      color: rgba(255,255,255,0.98);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 900;
      font-size: 13px;
      cursor: grab;
      user-select: none;
      box-shadow: 0 10px 24px rgba(0,0,0,0.25);
    }
    .hero-textpos-wa.dragging { cursor: grabbing; }

    .hero-textpos-cta {
      position: absolute;
      left: 50%;
      top: 70%;
      transform: translate(-50%, -50%);
      padding: 10px 14px;
      border-radius: 999px;
      background: rgba(255,255,255,0.14);
      border: 1px solid rgba(255,255,255,0.18);
      color: rgba(255,255,255,0.95);
      font-weight: 800;
      font-size: 12px;
      cursor: grab;
      user-select: none;
      white-space: nowrap;
    }
    .hero-textpos-cta.dragging { cursor: grabbing; }
    .hero-textpos-cta.secondary {
      top: 78%;
      background: rgba(0,0,0,0.22);
      border: 1px solid rgba(255,255,255,0.22);
    }
    .hero-textpos-controls {
      display: grid;
      gap: 0.75rem;
      margin-top: 0.75rem;
      max-width: 900px;
    }
    .hero-textpos-row {
      display: grid;
      grid-template-columns: 120px 1fr 64px;
      align-items: center;
      gap: 0.75rem;
      color: var(--color-text-muted);
      font-size: 0.9rem;
    }
    .hero-textpos-row input[type="range"] { width: 100%; }
    .hero-textpos-actions { display: flex; gap: 0.75rem; align-items: center; }

    /* Loading Screen */
    .loading-screen {
      position: fixed;
      inset: 0;
      background: var(--color-bg);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      transition: opacity 0.5s, visibility 0.5s;
    }

    .loading-screen.hidden {
      opacity: 0;
      visibility: hidden;
    }

    .spinner {
      width: 60px;
      height: 60px;
      border: 4px solid var(--color-border);
      border-top-color: var(--color-primary);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Header */
    .header {
      background: var(--color-bg-card);
      border-bottom: 2px solid var(--color-border);
      padding: 1.5rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: var(--shadow-md);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 1.5rem;
    }

    .logo {
      font-size: 1.8rem;
      font-weight: 800;
      background: linear-gradient(135deg, var(--color-primary-light), var(--color-accent));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      letter-spacing: -0.5px;
    }

    .property-name {
      font-size: 1.2rem;
      font-weight: 600;
      color: var(--color-text-muted);
    }

    .property-name span {
      color: var(--color-text);
      font-weight: 700;
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .last-sync {
      font-size: 0.85rem;
      color: var(--color-text-muted);
      font-family: var(--font-mono);
    }

    .btn {
      padding: 0.6rem 1.2rem;
      border: none;
      border-radius: var(--radius-sm);
      font-weight: 600;
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.3s;
      font-family: var(--font-main);
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--color-primary), var(--color-primary-light));
      color: white;
      box-shadow: 0 4px 12px rgba(8, 145, 178, 0.4);
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(8, 145, 178, 0.5);
    }

    .btn-secondary {
      background: var(--color-bg-light);
      color: var(--color-text);
      border: 1px solid var(--color-border);
    }

    .btn-secondary:hover {
      background: var(--color-border);
    }

    /* Main Container */
    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 2rem;
    }

    /* Stats Grid */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2rem;
    }

    .stat-card {
      background: var(--color-bg-card);
      padding: 1.5rem;
      border-radius: var(--radius-lg);
      border: 1px solid var(--color-border);
      box-shadow: var(--shadow-sm);
      transition: all 0.3s;
      position: relative;
      overflow: hidden;
    }

    .stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, var(--color-primary), var(--color-accent));
      opacity: 0;
      transition: opacity 0.3s;
    }

    .stat-card:hover {
      transform: translateY(-5px);
      box-shadow: var(--shadow-lg);
      border-color: var(--color-primary);
    }

    .stat-card:hover::before {
      opacity: 1;
    }

    .stat-label {
      font-size: 0.85rem;
      color: var(--color-text-muted);
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 0.5rem;
      font-weight: 600;
    }

    .stat-value {
      font-size: 2.5rem;
      font-weight: 800;
      color: var(--color-text);
      line-height: 1;
      margin-bottom: 0.5rem;
    }

    .stat-subtext {
      font-size: 0.9rem;
      color: var(--color-text-muted);
    }

    .status-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.4rem 0.8rem;
      border-radius: var(--radius-sm);
      font-size: 0.85rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .status-badge.live {
      background: rgba(16, 185, 129, 0.2);
      color: var(--color-success);
      border: 1px solid var(--color-success);
    }

    .status-badge.inactive {
      background: rgba(239, 68, 68, 0.2);
      color: var(--color-danger);
      border: 1px solid var(--color-danger);
    }

    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: currentColor;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    /* Content Grid */
    .content-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 2rem;
      margin-bottom: 2rem;
    }

    @media (max-width: 1024px) {
      .content-grid {
        grid-template-columns: 1fr;
      }
    }

    .section {
      background: var(--color-bg-card);
      padding: 2rem;
      border-radius: var(--radius-xl);
      border: 1px solid var(--color-border);
      box-shadow: var(--shadow-md);
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
      padding-bottom: 1rem;
      border-bottom: 2px solid var(--color-border);
    }

    .section-title {
      font-size: 1.4rem;
      font-weight: 700;
      color: var(--color-text);
    }

    /* Website Preview */
    .website-preview {
      grid-column: 1 / -1;
    }

    .iframe-wrapper {
      position: relative;
      width: 100%;
      height: 500px;
      border-radius: var(--radius-md);
      overflow: hidden;
      background: #fff;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
    }

    .iframe-wrapper iframe {
      width: 100%;
      height: 100%;
      border: none;
    }

    .preview-actions {
      display: flex;
      gap: 1rem;
      margin-top: 1rem;
    }

    /* Quota Chart */
    .quota-chart {
      height: 250px;
      margin-top: 1rem;
    }

    .quota-bars {
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
      margin-top: 1.5rem;
    }

    .quota-bar-wrapper {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .quota-bar-label {
      display: flex;
      justify-content: space-between;
      font-size: 0.9rem;
      font-weight: 600;
      color: var(--color-text-muted);
    }

    .quota-bar {
      height: 20px;
      background: var(--color-bg-light);
      border-radius: var(--radius-sm);
      overflow: hidden;
      position: relative;
    }

    .quota-bar-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--color-primary), var(--color-primary-light));
      transition: width 0.5s ease;
      border-radius: var(--radius-sm);
      position: relative;
    }

    .quota-bar-fill.warning {
      background: linear-gradient(90deg, var(--color-warning), #fbbf24);
    }

    .quota-bar-fill.danger {
      background: linear-gradient(90deg, var(--color-danger), #f87171);
    }

    /* Bookings Table */
    .bookings-table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      margin-top: 1rem;
    }

    .bookings-table thead {
      background: var(--color-bg-light);
    }

    .bookings-table th {
      padding: 1rem;
      text-align: left;
      font-weight: 600;
      font-size: 0.85rem;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: var(--color-text-muted);
      border-bottom: 2px solid var(--color-border);
    }

    .bookings-table td {
      padding: 1rem;
      border-bottom: 1px solid var(--color-border);
      color: var(--color-text);
    }

    .bookings-table tr:hover {
      background: var(--color-bg-light);
    }

    /* Gallery Grid */
    .gallery-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 1rem;
      margin-top: 1rem;
    }

    .gallery-item {
      position: relative;
      aspect-ratio: 1;
      border-radius: var(--radius-md);
      overflow: hidden;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: var(--shadow-sm);
    }

    .gallery-item:hover {
      transform: scale(1.05);
      box-shadow: var(--shadow-lg);
    }

    .gallery-item img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .gallery-item-actions {
      position: absolute;
      top: 0.5rem;
      right: 0.5rem;
      display: flex;
      gap: 0.3rem;
      opacity: 0;
      transition: opacity 0.3s;
    }

    .gallery-item:hover .gallery-item-actions {
      opacity: 1;
    }

    .gallery-action-btn {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      border: none;
      background: rgba(0, 0, 0, 0.7);
      color: white;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.9rem;
      transition: all 0.3s;
    }

    .gallery-action-btn:hover {
      background: var(--color-danger);
      transform: scale(1.1);
    }

    .upload-area {
      border: 2px dashed var(--color-border);
      border-radius: var(--radius-md);
      padding: 2rem;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s;
      background: var(--color-bg-light);
    }

    .upload-area:hover {
      border-color: var(--color-primary);
      background: rgba(8, 145, 178, 0.1);
    }

    .upload-area input[type="file"] {
      display: none;
    }

    .upload-icon {
      font-size: 3rem;
      color: var(--color-text-muted);
      margin-bottom: 1rem;
    }

    /* Settings Form */
    .settings-form {
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
      margin-top: 1rem;
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .form-label {
      font-weight: 600;
      font-size: 0.9rem;
      color: var(--color-text-muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .form-input {
      padding: 0.8rem 1rem;
      background: var(--color-bg-light);
      border: 1px solid var(--color-border);
      border-radius: var(--radius-sm);
      color: var(--color-text);
      font-family: var(--font-main);
      font-size: 1rem;
      transition: all 0.3s;
    }

    .form-input:focus {
      outline: none;
      border-color: var(--color-primary);
      box-shadow: 0 0 0 3px rgba(8, 145, 178, 0.2);
    }

    textarea.form-input {
      resize: vertical;
      min-height: 100px;
    }

    /* Alerts */
    .alert {
      padding: 1rem 1.5rem;
      border-radius: var(--radius-md);
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      gap: 1rem;
      font-weight: 500;
    }

    .alert.success {
      background: rgba(16, 185, 129, 0.2);
      border: 1px solid var(--color-success);
      color: var(--color-success);
    }

    .alert.warning {
      background: rgba(245, 158, 11, 0.2);
      border: 1px solid var(--color-warning);
      color: var(--color-warning);
    }

    .alert.danger {
      background: rgba(239, 68, 68, 0.2);
      border: 1px solid var(--color-danger);
      color: var(--color-danger);
    }
  </style>
</head>
<body>
  <!-- Loading Screen -->
  <div class="loading-screen" id="loadingScreen">
    <div class="spinner"></div>
  </div>

  <!-- Header -->
  <header class="header">
    <div class="header-left">
      <div class="logo">Webzyl</div>
      <div class="property-name">Property: <span id="propertyName">Loading...</span></div>
    </div>
    <div class="header-right">
      <div class="last-sync">Last sync: <span id="lastSync">--</span></div>
      <button class="btn btn-primary" onclick="refreshDashboard()">üîÑ Refresh</button>
      <button class="btn btn-secondary" onclick="logout()">Logout</button>
    </div>
  </header>

  <!-- Main Container -->
  <div class="container">
    <!-- Stats Grid -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-label">Website Status</div>
        <div class="stat-value">
          <span class="status-badge live" id="statusBadge">
            <span class="status-dot"></span>
            <span>LIVE</span>
          </span>
        </div>
        <div class="stat-subtext">Active and accepting bookings</div>
      </div>

      <div class="stat-card">
        <div class="stat-label">Current Plan</div>
        <div class="stat-value" id="planTier">Professional</div>
        <div class="stat-subtext" id="planPrice">‚Çπ199/month</div>
      </div>

      <div class="stat-card">
        <div class="stat-label">WhatsApp Quota</div>
        <div class="stat-value" id="whatsappQuota">50/50</div>
        <div class="stat-subtext" id="whatsappPercent">100% used</div>
      </div>

      <div class="stat-card">
        <div class="stat-label">SMS Quota</div>
        <div class="stat-value" id="smsQuota">0/50</div>
        <div class="stat-subtext" id="smsPercent">0% used</div>
      </div>

      <div class="stat-card">
        <div class="stat-label">Bookings This Month</div>
        <div class="stat-value" id="bookingsMonth">0</div>
        <div class="stat-subtext">Total bookings: <span id="bookingsTotal">0</span></div>
      </div>
    </div>

    <!-- Content Grid -->
    <div class="content-grid">
      <!-- Website Preview -->
      <div class="section website-preview">
        <div class="section-header">
          <h2 class="section-title">üåê Live Website Preview</h2>
          <button class="btn btn-primary" onclick="openWebsite()">Open in New Tab ‚Üí</button>
        </div>
        <div class="iframe-wrapper">
          <iframe id="websitePreview" src=""></iframe>
        </div>
        <div class="preview-actions">
          <button class="btn btn-secondary" onclick="copyWebsiteLink()">üìã Copy Link</button>
          <button class="btn btn-secondary" onclick="shareWebsite()">üì§ Share</button>
        </div>
      </div>

      <!-- Quota Usage -->
      <div class="section">
        <div class="section-header">
          <h2 class="section-title">üìä Quota Usage</h2>
          <button class="btn btn-secondary" onclick="resetQuota()">Reset Demo</button>
        </div>
        
        <div class="quota-bars">
          <div class="quota-bar-wrapper">
            <div class="quota-bar-label">
              <span>WhatsApp Messages</span>
              <span id="whatsappCount">0/50</span>
            </div>
            <div class="quota-bar">
              <div class="quota-bar-fill" id="whatsappBar" style="width: 0%"></div>
            </div>
          </div>

          <div class="quota-bar-wrapper">
            <div class="quota-bar-label">
              <span>SMS Messages</span>
              <span id="smsCount">0/50</span>
            </div>
            <div class="quota-bar">
              <div class="quota-bar-fill" id="smsBar" style="width: 0%"></div>
            </div>
          </div>
        </div>

        <div class="alert warning" style="margin-top: 1.5rem;" id="quotaAlert">
          <span>‚ö†Ô∏è</span>
          <span>You've reached your WhatsApp quota. Upgrade to Business plan for 100 messages/month.</span>
        </div>
      </div>

      <!-- Recent Bookings -->
      <div class="section">
        <div class="section-header">
          <h2 class="section-title">üìÖ Recent Bookings</h2>
          <button class="btn btn-secondary" onclick="exportBookings()">Export CSV</button>
        </div>
        
        <table class="bookings-table">
          <thead>
            <tr>
              <th>Date</th>
              <th>Guest</th>
              <th>Contact</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody id="bookingsTableBody">
            <tr>
              <td colspan="4" style="text-align: center; padding: 2rem; color: var(--color-text-muted);">
                No bookings yet
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Hero Image Manager -->
    <div class="section">
      <div class="section-header">
        <h2 class="section-title"> Hero Image</h2>
        <button class="btn btn-primary" id="heroUploadBtn" onclick="document.getElementById('heroUpload').click()">
           Upload Hero Image
        </button>
        <input type="file" id="heroUpload" accept="image/*" onchange="handleHeroUpload(event)" style="display: none;">
      </div>

      <div class="form-group" style="margin-top: 1rem;">
        <label class="form-label">Hero Background</label>
        <div style="display:flex; gap: 14px; flex-wrap: wrap; align-items: center;">
          <label style="display:flex; align-items:center; gap: 8px; cursor: pointer;">
            <input type="radio" name="heroBgType" id="settingHeroBgTypeNone" value="none" onchange="updateHeroBackgroundUI()">
            <span>Blank / White</span>
          </label>
          <label style="display:flex; align-items:center; gap: 8px; cursor: pointer;">
            <input type="radio" name="heroBgType" id="settingHeroBgTypePreset" value="preset" onchange="updateHeroBackgroundUI()">
            <span>Preset Image</span>
          </label>
          <label style="display:flex; align-items:center; gap: 8px; cursor: pointer;">
            <input type="radio" name="heroBgType" id="settingHeroBgTypeCustom" value="custom" onchange="updateHeroBackgroundUI()">
            <span>Custom Image</span>
          </label>
        </div>

        <div id="heroBgPresetWrap" style="margin-top: 10px; display:none;">
          <div id="heroBgPresetGrid" style="display:grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 10px; max-width: 820px;"></div>
          <input type="hidden" id="settingHeroBgPreset" value="platform-default">
          <p style="font-size: 0.85rem; color: var(--color-text-muted); margin-top: 0.5rem;">Choose one preset background (3‚Äì6 options).</p>
        </div>
      </div>
      
      <div id="heroPreview" style="margin-top: 1rem;">
        <!-- Hero image preview will be shown here -->
      </div>

      <div class="form-group" style="margin-top: 1rem;">
        <label class="form-label">Hero Image URL</label>
        <input type="url" class="form-input" id="settingHeroImage" placeholder="https://...">
        <p style="font-size: 0.85rem; color: var(--color-text-muted); margin-top: 0.5rem;">
          Primary banner image displayed at the top of your website
        </p>
      </div>

      <div class="form-group" style="margin-top: 1rem;">
        <label class="form-label">Header Style</label>
        <select class="form-input" id="settingHeaderStyleMode" onchange="updateHeaderStyleUI()">
          <option value="auto">Auto (Recommended)</option>
          <option value="light">Light (for dark images)</option>
          <option value="dark">Dark (for white/light hero)</option>
          <option value="custom">Custom</option>
        </select>
        <p style="font-size: 0.85rem; color: var(--color-text-muted); margin-top: 0.5rem;">
          Controls the top header (logo + menu) contrast over the hero.
        </p>

        <div id="headerStyleCustomWrap" style="margin-top: 10px; display:none;">
          <div class="form-group" style="margin-top: 0.75rem;">
            <label class="form-label">Header Text Color</label>
            <div style="display:flex; gap: 10px; align-items: center;">
              <input type="color" id="settingHeaderTextColorPicker" value="#1a202c" oninput="syncHeaderColorFromPicker()" style="width: 54px; height: 42px; padding: 0; border: 1px solid var(--color-border); border-radius: 10px; background: transparent;">
              <input type="text" class="form-input" id="settingHeaderTextColor" placeholder="#1a202c" oninput="syncHeaderColorFromText()" style="flex:1;">
            </div>
          </div>

          <div class="form-group" style="margin-top: 0.75rem;">
            <label class="form-label">Brand Font Style</label>
            <select class="form-input" id="settingHeaderBrandFontStyle">
              <option value="">Default</option>
              <option value="modern">Modern</option>
              <option value="classic">Classic</option>
              <option value="elegant">Elegant</option>
              <option value="mono">Mono</option>
            </select>
          </div>

          <div class="form-group" style="margin-top: 0.75rem;">
            <label class="form-label">Brand Font Weight</label>
            <select class="form-input" id="settingHeaderBrandFontWeight">
              <option value="">Default</option>
              <option value="500">500</option>
              <option value="600">600</option>
              <option value="700">700</option>
              <option value="800">800</option>
            </select>
          </div>

          <div class="form-group" style="margin-top: 0.75rem;">
            <label class="form-label">Brand Font Size</label>
            <select class="form-input" id="settingHeaderBrandFontSizePx">
              <option value="">Default</option>
              <option value="20">Small</option>
              <option value="24">Medium</option>
              <option value="28">Large</option>
              <option value="32">XL</option>
            </select>
          </div>
        </div>
      </div>

      <div class="form-group" style="margin-top: 1rem;">
        <label class="form-label">Desktop Hero Mode</label>
        <select class="form-input" id="settingHeroFitMode" onchange="updateHeroCropperVisibility()">
          <option value="cover">Cover (Full screen, may crop)</option>
          <option value="contain">Fit (No crop on desktop)</option>
        </select>
        <p style="font-size: 0.85rem; color: var(--color-text-muted); margin-top: 0.5rem;">
          If any text in the image is getting cut (like GRAND ROYAL), use Fit.
        </p>
      </div>

      <div class="form-group" style="margin-top: 1rem;">
        <label class="form-label">Mobile Hero Box</label>
        <select class="form-input" id="settingMobileHeroBoxed">
          <option value="true">On (Boxed headline/CTA)</option>
          <option value="false">Off (Flat mobile hero)</option>
        </select>
        <p style="font-size: 0.85rem; color: var(--color-text-muted); margin-top: 0.5rem;">
          Controls whether the mobile hero uses the shallow boxed callout style.
        </p>
      </div>

      <div class="form-group" style="margin-top: 1rem;">
        <label class="form-label">Desktop Crop (Cover Preview)</label>
        <div class="hero-cropper-wrapper" id="heroCropperWrapper">
          <div id="heroCropper" class="hero-cropper" aria-label="Desktop hero crop preview"></div>

          <div class="hero-cropper-controls">
          <div class="hero-cropper-row">
            <span>Horizontal</span>
            <input type="range" id="heroCropX" min="0" max="100" step="1" value="50" />
            <span id="heroCropXVal">50%</span>
          </div>
          <div class="hero-cropper-row">
            <span>Vertical</span>
            <input type="range" id="heroCropY" min="0" max="100" step="1" value="50" />
            <span id="heroCropYVal">50%</span>
          </div>
          <div class="hero-cropper-actions">
            <button type="button" class="btn btn-secondary" onclick="resetHeroCrop()">Reset</button>
            <span style="font-size: 0.85rem; color: var(--color-text-muted);">Drag image to set what stays visible on Desktop.</span>
          </div>
          </div>

          <input type="hidden" id="settingHeroObjectPosition" value="">
        </div>
        <p style="font-size: 0.85rem; color: var(--color-text-muted); margin-top: 0.5rem;">
          This controls the hero crop focus for Desktop (cover mode). Leave as default unless something is cut.
        </p>
      </div>

      <div class="form-group" style="margin-top: 1rem;">
        <label class="form-label">Hero Title (Optional)</label>
        <input type="text" class="form-input" id="settingHeroTitle" placeholder="Welcome to Paradise" oninput="updateHeroContentPositionUI()">
        <p style="font-size: 0.85rem; color: var(--color-text-muted); margin-top: 0.5rem;">
          This controls only the big center title in the hero. If empty, it uses <b>Property Name</b>.
        </p>

        <div style="display:flex; gap: 10px; flex-wrap: wrap; align-items: center; margin-top: 10px; max-width: 900px;">
          <label class="form-label" style="margin:0; min-width: 180px;">Hero Title Mode (Default)</label>
          <select class="form-input" id="settingHeroTitleMode" style="max-width: 220px;" onchange="updateHeroContentPositionUI()">
            <option value="auto">Auto</option>
            <option value="show">Show</option>
            <option value="hide">Hide</option>
          </select>

          <label class="form-label" style="margin:0; min-width: 190px;">Desktop Override</label>
          <select class="form-input" id="settingHeroTitleModeDesktop" style="max-width: 220px;" onchange="updateHeroContentPositionUI()">
            <option value="">Inherit Default</option>
            <option value="auto">Auto</option>
            <option value="show">Show</option>
            <option value="hide">Hide</option>
          </select>

          <label class="form-label" style="margin:0; min-width: 180px;">Mobile Override</label>
          <select class="form-input" id="settingHeroTitleModeMobile" style="max-width: 220px;" onchange="updateHeroContentPositionUI()">
            <option value="">Inherit Default</option>
            <option value="auto">Auto</option>
            <option value="show">Show</option>
            <option value="hide">Hide</option>
          </select>

          <label class="form-label" style="margin:0; min-width: 220px; margin-left: 6px;">Hero Image Contains Brand</label>
          <select class="form-input" id="settingHeroImageContainsBrand" style="max-width: 220px;" onchange="updateHeroContentPositionUI()">
            <option value="false">No</option>
            <option value="true">Yes</option>
          </select>
        </div>
      </div>

      <div class="form-group" style="margin-top: 1rem;">
        <label class="form-label">Hero Text & Buttons Position</label>

        <div style="display:flex; gap: 10px; align-items:center; flex-wrap: wrap; margin-bottom: 10px;">
          <select class="form-input" id="settingHeroContentTarget" style="max-width: 220px;" onchange="updateHeroContentPositionUI()">
            <option value="desktop">Edit Desktop</option>
            <option value="mobile">Edit Mobile</option>
          </select>
          <select class="form-input" id="settingHeroContentItem" style="max-width: 220px;" onchange="updateHeroContentPositionUI()">
            <option value="headline">Position: Headline</option>
            <option value="tagline">Position: Tagline</option>
            <option value="primary">Position: Primary Button</option>
            <option value="secondary">Position: Secondary Button</option>
            <option value="whatsapp">Position: WhatsApp Button</option>
          </select>
          <span style="font-size: 0.85rem; color: var(--color-text-muted);">Drag each item to reposition (saved per device).</span>
        </div>

        <div id="heroTextPos" class="hero-textpos desktop" aria-label="Hero text position preview">
          <div id="heroTextPosBg" class="hero-textpos-bg"></div>
          <div class="hero-textpos-dim"></div>
          <div id="heroTextPosHeadline" class="hero-textpos-item headline" role="button" aria-label="Drag headline">Headline</div>
          <div id="heroTextPosTagline" class="hero-textpos-item tagline" role="button" aria-label="Drag tagline">Tagline</div>
          <div id="heroTextPosPrimary" class="hero-textpos-cta primary" role="button" aria-label="Drag primary button">Primary</div>
          <div id="heroTextPosSecondary" class="hero-textpos-cta secondary" role="button" aria-label="Drag secondary button">Secondary</div>
          <div id="heroTextPosWhatsapp" class="hero-textpos-wa" role="button" aria-label="Drag WhatsApp button">WA</div>
        </div>

        <div class="hero-textpos-controls">
          <div class="hero-textpos-row">
            <span>Horizontal</span>
            <input type="range" id="heroTextPosX" min="0" max="100" step="1" value="50" oninput="onHeroContentPosSlider()" />
            <span id="heroTextPosXVal">50%</span>
          </div>
          <div class="hero-textpos-row">
            <span>Vertical</span>
            <input type="range" id="heroTextPosY" min="0" max="100" step="1" value="50" oninput="onHeroContentPosSlider()" />
            <span id="heroTextPosYVal">50%</span>
          </div>
          <div class="hero-textpos-actions">
            <button type="button" class="btn btn-secondary" onclick="resetHeroContentPos()">Reset (Default)</button>
            <button type="button" class="btn btn-secondary" onclick="resetHeroAll()">Reset Hero (All)</button>
            <span id="heroTextPosStatus" style="font-size: 0.85rem; color: var(--color-text-muted);"></span>
          </div>
        </div>

        <input type="hidden" id="settingHeroTextPositionDesktop" value="">
        <input type="hidden" id="settingHeroTextPositionMobile" value="">
        <input type="hidden" id="settingHeroHeadlinePositionDesktop" value="">
        <input type="hidden" id="settingHeroHeadlinePositionMobile" value="">
        <input type="hidden" id="settingHeroTaglinePositionDesktop" value="">
        <input type="hidden" id="settingHeroTaglinePositionMobile" value="">
        <input type="hidden" id="settingHeroPrimaryCtaPositionDesktop" value="">
        <input type="hidden" id="settingHeroPrimaryCtaPositionMobile" value="">
        <input type="hidden" id="settingHeroSecondaryCtaPositionDesktop" value="">
        <input type="hidden" id="settingHeroSecondaryCtaPositionMobile" value="">
        <input type="hidden" id="settingWhatsappFloatPositionDesktop" value="">
        <input type="hidden" id="settingWhatsappFloatPositionMobile" value="">

        <div style="display:flex; gap: 10px; flex-wrap: wrap; align-items: center; margin-top: 10px; max-width: 900px;">
          <label class="form-label" style="margin:0; min-width: 170px;">Primary Button Text</label>
          <input type="text" class="form-input" id="settingPrimaryActionLabel" placeholder="Book your Stay" style="max-width: 320px;">
          <span style="font-size: 0.85rem; color: var(--color-text-muted);">Optional override; if empty, auto label is used.</span>
        </div>

        <div style="display:grid; gap: 10px; margin-top: 12px; max-width: 900px;">
          <div style="display:flex; gap: 10px; flex-wrap: wrap; align-items: center;">
            <label class="form-label" style="margin:0; min-width: 140px;">Text Color</label>
            <input type="color" id="settingHeroTextColor" value="#ffffff" style="width: 56px; height: 40px; border-radius: 10px; border: 1px solid var(--color-border); background: transparent;">
            <label class="form-label" style="margin:0; min-width: 110px; margin-left: 6px;">Font Style</label>
            <select class="form-input" id="settingHeroFontStyle" style="max-width: 220px;" onchange="updateHeroContentPositionUI()">
              <option value="">Default</option>
              <option value="modern">Modern</option>
              <option value="classic">Classic</option>
              <option value="elegant">Elegant</option>
              <option value="mono">Mono</option>
            </select>
            <label class="form-label" style="margin:0; min-width: 170px; margin-left: 6px;">Primary Button Font</label>
            <select class="form-input" id="settingHeroPrimaryCtaFontStyle" style="max-width: 220px;" onchange="updateHeroContentPositionUI()">
              <option value="">(Use Hero Font)</option>
              <option value="modern">Modern</option>
              <option value="classic">Classic</option>
              <option value="elegant">Elegant</option>
              <option value="mono">Mono</option>
            </select>
            <label class="form-label" style="margin:0; min-width: 190px; margin-left: 6px;">Secondary Button Font</label>
            <select class="form-input" id="settingHeroSecondaryCtaFontStyle" style="max-width: 220px;" onchange="updateHeroContentPositionUI()">
              <option value="">(Use Hero Font)</option>
              <option value="modern">Modern</option>
              <option value="classic">Classic</option>
              <option value="elegant">Elegant</option>
              <option value="mono">Mono</option>
            </select>
            <button type="button" class="btn btn-secondary" onclick="resetHeroTextStyle()">Reset Styles</button>
          </div>
          <div class="hero-textpos-row">
            <span>Title Size</span>
            <input type="range" id="heroTitleSize" min="24" max="96" step="1" value="56" oninput="onHeroTextStyleSlider()" />
            <span id="heroTitleSizeVal">56px</span>
          </div>
          <div class="hero-textpos-row">
            <span>Tagline Size</span>
            <input type="range" id="heroTaglineSize" min="12" max="34" step="1" value="18" oninput="onHeroTextStyleSlider()" />
            <span id="heroTaglineSizeVal">18px</span>
          </div>
        </div>

        <input type="hidden" id="settingHeroTitleSizeDesktopPx" value="">
        <input type="hidden" id="settingHeroTitleSizeMobilePx" value="">
        <input type="hidden" id="settingHeroTaglineSizeDesktopPx" value="">
        <input type="hidden" id="settingHeroTaglineSizeMobilePx" value="">

        <p style="font-size: 0.85rem; color: var(--color-text-muted); margin-top: 0.5rem;">
          Stored as percentages like <span style="font-family: var(--font-mono);">50% 35%</span>. If empty, default positioning is used.
        </p>
      </div>
    </div>

    <!-- Logo Manager -->
    <div class="section">
      <div class="section-header">
        <h2 class="section-title"> Logo</h2>
        <button class="btn btn-primary" onclick="document.getElementById('logoUpload').click()">
           Upload Logo
        </button>
        <input type="file" id="logoUpload" accept="image/*" onchange="handleLogoUpload(event)" style="display: none;">
      </div>

      <div id="logoPreview" style="margin-top: 1rem;">
        <!-- Logo preview will be shown here -->
      </div>

      <div class="form-group" style="margin-top: 1rem;">
        <label class="form-label">Logo URL</label>
        <input type="url" class="form-input" id="settingLogoUrl" placeholder="https://...">
        <p style="font-size: 0.85rem; color: var(--color-text-muted); margin-top: 0.5rem;">
          Optional. If set, the website header will show this logo.
        </p>
      </div>
    </div>

    <!-- Gallery Manager -->
    <div class="section">
      <div class="section-header">
        <h2 class="section-title">üñºÔ∏è Gallery Manager</h2>
        <button class="btn btn-primary" onclick="document.getElementById('galleryUpload').click()">
          ‚ûï Upload Image
        </button>
        <input type="file" id="galleryUpload" accept="image/*" onchange="handleGalleryUpload(event)">
      </div>

      <div class="gallery-grid" id="galleryGrid">
        <!-- Gallery items will be loaded here -->
      </div>

      <div class="upload-area" onclick="document.getElementById('galleryUpload').click()">
        <div class="upload-icon">‚òÅÔ∏è</div>
        <div style="font-weight: 600; margin-bottom: 0.5rem;">Drag & Drop or Click to Upload</div>
        <div style="color: var(--color-text-muted); font-size: 0.9rem;">Supports: JPG, PNG, WebP (Max 5MB)</div>
      </div>
    </div>

    <!-- Settings -->
    <div class="section">
      <div class="section-header">
        <h2 class="section-title">‚öôÔ∏è Basic Settings</h2>
        <button class="btn btn-primary" onclick="saveSettings()">üíæ Save Changes</button>
      </div>

      <form class="settings-form" id="settingsForm">
        <div class="form-group">
          <label class="form-label">Property Name</label>
          <input type="text" class="form-input" id="settingName" placeholder="Mountain View Resort">
        </div>

        <div class="form-group">
          <label class="form-label">Tagline</label>
          <input type="text" class="form-input" id="settingTagline" placeholder="Where Mountains Meet Luxury">
        </div>

        <div class="form-group">
          <label class="form-label">About Description</label>
          <textarea class="form-input" id="settingAbout" placeholder="Tell visitors about your property..."></textarea>
        </div>

        <div class="form-group">
          <label class="form-label">Contact Phone</label>
          <input type="tel" class="form-input" id="settingPhone" placeholder="+91 98765 43210">
        </div>

        <div class="form-group">
          <label class="form-label">Contact Email</label>
          <input type="email" class="form-input" id="settingEmail" placeholder="info@property.com">
        </div>

        <div class="form-group">
          <label class="form-label">WhatsApp Number</label>
          <input type="tel" class="form-input" id="settingWhatsapp" placeholder="+91 98765 43210">
        </div>

        <!-- SUPER ADMIN SECTION -->
        <div class="form-group" style="margin-top: 2rem; padding-top: 2rem; border-top: 2px solid var(--color-danger);">
          <label class="form-label" style="font-size: 1.1rem; font-weight: 700; color: var(--color-danger);">
            üîê Super Admin Controls
            <span style="font-size: 0.85rem; color: var(--color-text-muted); font-weight: 400; margin-left: 0.5rem;">(Full system access)</span>
          </label>
        </div>

        <div class="form-group">
          <label class="form-label">Property Slug (URL)</label>
          <div style="display: flex; gap: 0.75rem; align-items: center;">
            <input type="text" class="form-input" id="settingSlug" readonly style="flex: 1; background: rgba(255,255,255,0.05);">
            <button type="button" class="btn btn-secondary" onclick="changeSlug()" style="white-space: nowrap;">Change Slug</button>
          </div>
          <small style="color: var(--color-text-muted); margin-top: 0.25rem; display: block;">Current URL: https://<span id="currentSlugDisplay"></span>.webzyl.com</small>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
          <div class="form-group">
            <label class="form-label">Plan Tier</label>
            <select class="form-input" id="settingPlanTier">
              <option value="trial">Trial (Free)</option>
              <option value="basic">Basic</option>
              <option value="standard">Standard</option>
              <option value="premium">Premium</option>
            </select>
          </div>

          <div class="form-group">
            <label class="form-label">Property Status</label>
            <select class="form-input" id="settingStatus">
              <option value="active">Active</option>
              <option value="inactive">Inactive</option>
              <option value="suspended">Suspended</option>
            </select>
          </div>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
          <div class="form-group">
            <label class="form-label">WhatsApp Quota Used</label>
            <div style="display: flex; gap: 0.75rem; align-items: center;">
              <input type="number" class="form-input" id="settingQuotaWhatsappUsed" style="flex: 1;">
              <button type="button" class="btn btn-secondary" onclick="resetWhatsAppQuota()" style="white-space: nowrap;">üîÑ Reset</button>
            </div>
          </div>

          <div class="form-group">
            <label class="form-label">WhatsApp Monthly Limit</label>
            <input type="number" class="form-input" id="settingQuotaWhatsappMonthly">
          </div>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
          <div class="form-group">
            <label class="form-label">Plan Expiry Date</label>
            <input type="date" class="form-input" id="settingPlanExpiry">
          </div>

          <div class="form-group">
            <label class="form-label">Category</label>
            <select class="form-input" id="settingCategory">
              <option value="hotel">Hotel</option>
              <option value="resort">Resort</option>
              <option value="homestay">Homestay</option>
              <option value="villa">Villa</option>
              <option value="apartment">Apartment</option>
            </select>
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">Base Price (per night)</label>
          <input type="number" class="form-input" id="settingBasePrice" placeholder="5000">
        </div>

        <!-- Design Profile Section -->
        <div class="form-group" style="margin-top: 2rem; padding-top: 2rem; border-top: 2px solid var(--color-border);">
          <label class="form-label" style="font-size: 1.1rem; font-weight: 700;">
             Design Profile
            <span style="font-size: 0.85rem; color: var(--color-text-muted); font-weight: 400; margin-left: 0.5rem;">(Advanced styling system)</span>
          </label>
          <select class="form-input" id="settingDesignProfile">
            <option value=""> Default - Standard template styling</option>
            <option value="luxury-heritage-v1"> Luxury Heritage - Premium, upscale properties</option>
            <option value="modern-premium-v1"> Modern Premium - Contemporary, stylish spaces</option>
          </select>
        </div>

        <div class="form-group">
          <label class="form-label">
            Variant Style
            <span style="font-size: 0.85rem; color: var(--color-text-muted); font-weight: 400; margin-left: 0.5rem;">(Only if design profile is selected)</span>
          </label>
          <select class="form-input" id="settingVariant">
            <option value="">Auto (System default)</option>
            <option value="calm"> Calm - Serene, peaceful tones</option>
            <option value="bold"> Bold - Vibrant, energetic colors</option>
            <option value="playful"> Playful - Fun, cheerful vibe</option>
          </select>
        </div>

        <div style="background: linear-gradient(135deg, rgba(8, 145, 178, 0.1), rgba(16, 185, 129, 0.1)); border: 1px solid rgba(8, 145, 178, 0.3); border-radius: var(--radius-md); padding: 1rem; margin-top: 1rem;">
          <p style="font-size: 0.9rem; color: var(--color-text); margin: 0;">
            <strong style="color: var(--color-primary-light);"> New!</strong> Design profiles provide advanced typography, spacing, and color systems optimized for your property type. Changes take effect immediately after saving.
          </p>
        </div>

        <!-- Location & Address -->
        <div class="form-group" style="margin-top: 2rem; padding-top: 2rem; border-top: 2px solid var(--color-border);">
          <label class="form-label" style="font-size: 1.1rem; font-weight: 700;"> Location & Address</label>
        </div>

        <div class="form-group">
          <label class="form-label">Full Address</label>
          <input type="text" class="form-input" id="settingAddress" placeholder="123 Main Street, Area Name">
        </div>

        <div class="form-group">
          <label class="form-label">City</label>
          <input type="text" class="form-input" id="settingCity" placeholder="City Name">
        </div>

        <div class="form-group">
          <label class="form-label">State</label>
          <input type="text" class="form-input" id="settingState" placeholder="State Name">
        </div>

        <!-- Category & Theme -->
        <div class="form-group" style="margin-top: 2rem; padding-top: 2rem; border-top: 2px solid var(--color-border);">
          <label class="form-label" style="font-size: 1.1rem; font-weight: 700;"> Category & Theme</label>
        </div>

        <div class="form-group">
          <label class="form-label">Business Category</label>
          <select class="form-input" id="settingCategory">
            <option value="">Select category...</option>
            <option value="homestay"> Homestay</option>
            <option value="resort"> Resort</option>
            <option value="hotel"> Hotel</option>
            <option value="villa"> Villa</option>
            <option value="cottage"> Cottage</option>
            <option value="restaurant"> Restaurant</option>
            <option value="cafe"> Cafe</option>
            <option value="professional"> Professional / Portfolio</option>
            <option value="student"> Student / Resume</option>
          </select>
        </div>

        <div class="form-group">
          <label class="form-label">Theme Color</label>
          <select class="form-input" id="settingTheme">
            <option value="ocean-breeze"> Ocean Breeze (Blue)</option>
            <option value="forest-mist"> Forest Mist (Green)</option>
            <option value="sunset-glow"> Sunset Glow (Orange)</option>
            <option value="royal-purple"> Royal Purple</option>
            <option value="elegant-grey"> Elegant Grey</option>
          </select>
        </div>

        <!-- Pricing -->
        <div class="form-group" style="margin-top: 2rem; padding-top: 2rem; border-top: 2px solid var(--color-border);">
          <label class="form-label" style="font-size: 1.1rem; font-weight: 700;"> Pricing</label>
        </div>

        <div class="form-group">
          <label class="form-label">Base Price (Starting from)</label>
          <input type="number" class="form-input" id="settingBasePrice" placeholder="2000">
        </div>

        <!-- Amenities Section (for hospitality) -->
        <div id="amenitiesSection" class="form-group" style="margin-top: 2rem; padding-top: 2rem; border-top: 2px solid var(--color-border); display: none;">
          <label class="form-label" style="font-size: 1.1rem; font-weight: 700;">‚ú® Amenities & Facilities</label>
          <p style="font-size: 0.9rem; color: var(--color-text-muted); margin-bottom: 1rem;">
            Select common amenities and add custom ones for your property
          </p>

          <!-- Common Amenities Checkboxes -->
          <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 0.75rem; margin-bottom: 1.5rem;">
            <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
              <input type="checkbox" value="Free WiFi" class="amenity-checkbox" style="width: 18px; height: 18px;">
              <span>Free WiFi</span>
            </label>
            <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
              <input type="checkbox" value="Free Parking" class="amenity-checkbox" style="width: 18px; height: 18px;">
              <span>Free Parking</span>
            </label>
            <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
              <input type="checkbox" value="Swimming Pool" class="amenity-checkbox" style="width: 18px; height: 18px;">
              <span>Swimming Pool</span>
            </label>
            <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
              <input type="checkbox" value="Restaurant" class="amenity-checkbox" style="width: 18px; height: 18px;">
              <span>Restaurant</span>
            </label>
            <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
              <input type="checkbox" value="Gym/Fitness Center" class="amenity-checkbox" style="width: 18px; height: 18px;">
              <span>Gym/Fitness Center</span>
            </label>
            <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
              <input type="checkbox" value="Spa Services" class="amenity-checkbox" style="width: 18px; height: 18px;">
              <span>Spa Services</span>
            </label>
            <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
              <input type="checkbox" value="24/7 Room Service" class="amenity-checkbox" style="width: 18px; height: 18px;">
              <span>24/7 Room Service</span>
            </label>
            <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
              <input type="checkbox" value="Air Conditioning" class="amenity-checkbox" style="width: 18px; height: 18px;">
              <span>Air Conditioning</span>
            </label>
            <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
              <input type="checkbox" value="Pet Friendly" class="amenity-checkbox" style="width: 18px; height: 18px;">
              <span>Pet Friendly</span>
            </label>
            <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
              <input type="checkbox" value="Laundry Service" class="amenity-checkbox" style="width: 18px; height: 18px;">
              <span>Laundry Service</span>
            </label>
            <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
              <input type="checkbox" value="Airport Transfer" class="amenity-checkbox" style="width: 18px; height: 18px;">
              <span>Airport Transfer</span>
            </label>
            <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
              <input type="checkbox" value="Garden/Terrace" class="amenity-checkbox" style="width: 18px; height: 18px;">
              <span>Garden/Terrace</span>
            </label>
            <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
              <input type="checkbox" value="Conference Room" class="amenity-checkbox" style="width: 18px; height: 18px;">
              <span>Conference Room</span>
            </label>
            <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
              <input type="checkbox" value="Kids Play Area" class="amenity-checkbox" style="width: 18px; height: 18px;">
              <span>Kids Play Area</span>
            </label>
            <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
              <input type="checkbox" value="BBQ Facilities" class="amenity-checkbox" style="width: 18px; height: 18px;">
              <span>BBQ Facilities</span>
            </label>
            <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
              <input type="checkbox" value="TV/Entertainment" class="amenity-checkbox" style="width: 18px; height: 18px;">
              <span>TV/Entertainment</span>
            </label>
            <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
              <input type="checkbox" value="Coffee/Tea Maker" class="amenity-checkbox" style="width: 18px; height: 18px;">
              <span>Coffee/Tea Maker</span>
            </label>
            <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
              <input type="checkbox" value="Safe Deposit Box" class="amenity-checkbox" style="width: 18px; height: 18px;">
              <span>Safe Deposit Box</span>
            </label>
          </div>

          <!-- Custom Amenities -->
          <div>
            <label class="form-label">Custom Amenities</label>
            <div id="amenities-inputs" style="display: flex; flex-direction: column; gap: 0.5rem;">
              <input type="text" class="form-input" id="customAmenity1" placeholder="e.g., Mountain View Rooms">
            </div>
            <button type="button" class="btn btn-secondary" onclick="addAmenityInput()" style="margin-top: 0.5rem;">+ Add Another Amenity</button>
          </div>
        </div>

        <!-- Rooms Section (for hospitality) -->
        <div id="roomsSection" class="form-group" style="margin-top: 2rem; padding-top: 2rem; border-top: 2px solid var(--color-border); display: none;">
          <label class="form-label" style="font-size: 1.1rem; font-weight: 700;">üõèÔ∏è Rooms & Accommodation</label>
          <p style="font-size: 0.9rem; color: var(--color-text-muted); margin-bottom: 1rem;">
            Add different room types available at your property
          </p>

          <div id="rooms-inputs" style="display: flex; flex-direction: column; gap: 1rem;">
            <!-- Rooms will be loaded here dynamically -->
          </div>

          <button type="button" onclick="addRoomInput()" class="btn btn-secondary" style="margin-top: 0.75rem;">+ Add Another Room Type</button>
        </div>

        <!-- Testimonials Section -->
        <div class="form-group" style="margin-top: 2rem; padding-top: 2rem; border-top: 2px solid var(--color-border);">
          <label class="form-label" style="font-size: 1.1rem; font-weight: 700;">üí¨ Guest Testimonials</label>
          <p style="font-size: 0.9rem; color: var(--color-text-muted); margin-bottom: 1rem;">
            Add and manage customer testimonials to build trust
          </p>

          <div id="reviews-inputs" style="display: flex; flex-direction: column; gap: 1rem;">
            <!-- Reviews will be loaded here dynamically -->
          </div>

          <button type="button" onclick="addReviewInput()" class="btn btn-secondary" style="margin-top: 0.75rem;">+ Add Testimonial</button>
        </div>

        <!-- Social Media -->
        <div class="form-group" style="margin-top: 2rem; padding-top: 2rem; border-top: 2px solid var(--color-border);">
          <label class="form-label" style="font-size: 1.1rem; font-weight: 700;"> Social Media</label>
        </div>

        <div class="form-group">
          <label class="form-label">Facebook URL</label>
          <input type="url" class="form-input" id="settingFacebook" placeholder="https://facebook.com/...">
        </div>

        <div class="form-group">
          <label class="form-label">Instagram URL</label>
          <input type="url" class="form-input" id="settingInstagram" placeholder="https://instagram.com/...">
        </div>

        <div class="form-group">
          <label class="form-label">Twitter URL</label>
          <input type="url" class="form-input" id="settingTwitter" placeholder="https://twitter.com/...">
        </div>

        <div class="form-group">
          <label class="form-label">YouTube URL</label>
          <input type="url" class="form-input" id="settingYoutube" placeholder="https://youtube.com/...">
        </div>

        <!-- Media Integration -->
        <div class="form-group" style="margin-top: 2rem; padding-top: 2rem; border-top: 2px solid var(--color-border);">
          <label class="form-label" style="font-size: 1.1rem; font-weight: 700;"> Media Integration</label>
        </div>

        <div class="form-group">
          <label class="form-label">Google Maps Link</label>
          <input type="url" class="form-input" id="settingMapLink" placeholder="https://goo.gl/maps/...">
        </div>

        <div class="form-group">
          <label class="form-label">Map Embed Code (iframe)</label>
          <textarea class="form-input" id="settingMapEmbed" placeholder="<iframe src=...></iframe>" rows="3"></textarea>
        </div>

        <div class="form-group">
          <label class="form-label">Video Embed Code (Legacy - optional)</label>
          <textarea class="form-input" id="settingYoutubeEmbed" placeholder="Paste old YouTube/Instagram embed code here (optional)" rows="3"></textarea>
        </div>

        <div class="form-group">
          <label class="form-label">Videos (Any Platform)</label>
          <div id="video-inputs" style="display: flex; flex-direction: column; gap: 0.75rem;"></div>
          <button type="button" class="btn btn-secondary" onclick="addVideoInput()" style="margin-top: 0.75rem;">+ Add Another Video</button>
          <div style="font-size: 0.85rem; color: var(--color-text-muted); margin-top: 0.5rem;">
            Add/remove videos here. For Instagram/Facebook, include a thumbnail URL.
          </div>
        </div>

      </form>

      <!-- Action Buttons -->
      <div style="margin-top: 2rem; padding: 1.5rem; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 8px; text-align: center;">
        <button class="btn btn-primary" onclick="saveSettings()" style="font-size: 1.1rem; padding: 1rem 3rem; background: white; color: #667eea; font-weight: bold; border: none; box-shadow: 0 4px 15px rgba(0,0,0,0.2);">
           Publish All Changes
        </button>
        <p style="margin-top: 1rem; color: white; opacity: 0.9; font-size: 0.9rem;">
          Save and publish all your edits to make them live on your website
        </p>
      </div>
    </div>
  </div>

  <script>
    // Global state
    let config = null;
    let slug = null;
    let bookings = [];
    let videoCount = 0;

    function extractFirstHttpUrl(raw) {
      const s = (raw || '').toString().trim();
      if (!s) return '';
      if (s.includes('<') || s.includes('>')) {
        const m = s.match(/https?:\/\/[^\s"'<>]+/i);
        if (m && m[0]) return m[0].replace(/&amp;/g, '&').trim();
      }
      return s.replace(/&amp;/g, '&').trim();
    }

    function isYouTubeUrl(url) {
      try {
        const u = new URL(url);
        const h = (u.hostname || '').toLowerCase();
        return h.includes('youtube.com') || h.includes('youtu.be');
      } catch (_) {
        return false;
      }
    }

    function addVideoInput(initialUrl = '', initialThumb = '') {
      videoCount++;
      const container = document.getElementById('video-inputs');
      if (!container) return;

      const row = document.createElement('div');
      row.style.display = 'flex';
      row.style.gap = '0.75rem';
      row.style.alignItems = 'center';

      row.innerHTML = `
        <input type="text" class="form-input" id="videoUrl${videoCount}" placeholder="Video URL or embed code" value="${String(initialUrl || '').replace(/"/g, '&quot;')}">
        <input type="url" class="form-input" id="videoThumb${videoCount}" placeholder="Thumbnail Image URL (optional)" value="${String(initialThumb || '').replace(/"/g, '&quot;')}">
        <button type="button" class="btn btn-secondary" onclick="this.parentElement.remove()" style="padding: 0.6rem 0.9rem;" title="Delete" aria-label="Delete video">√ó</button>
      `;

      container.appendChild(row);
    }

    function collectVideos() {
      const videos = [];
      const container = document.getElementById('video-inputs');
      if (!container) return videos;

      const urlInputs = container.querySelectorAll('input[id^="videoUrl"]');
      urlInputs.forEach(urlEl => {
        const idSuffix = (urlEl.id || '').replace('videoUrl', '');
        const thumbEl = document.getElementById(`videoThumb${idSuffix}`);
        const url = extractFirstHttpUrl(urlEl.value);
        const thumbnail = thumbEl ? extractFirstHttpUrl(thumbEl.value) : '';
        if (!url) return;
        videos.push({ url, thumbnail, title: '' });
      });
      return videos;
    }

    // Amenities functions
    let amenityCount = 1;

    function addAmenityInput(initialValue = '') {
      amenityCount++;
      const container = document.getElementById('amenities-inputs');
      if (!container) return;

      const input = document.createElement('input');
      input.type = 'text';
      input.className = 'form-input';
      input.id = `customAmenity${amenityCount}`;
      input.placeholder = 'e.g., Mountain View Rooms';
      input.value = initialValue;

      container.appendChild(input);
    }

    function collectAmenities() {
      const amenities = [];

      // Collect checked common amenities
      const checkboxes = document.querySelectorAll('.amenity-checkbox:checked');
      checkboxes.forEach(checkbox => {
        if (checkbox.value) {
          amenities.push(checkbox.value);
        }
      });

      // Collect custom amenities from inputs
      const container = document.getElementById('amenities-inputs');
      if (container) {
        const inputs = container.querySelectorAll('input[type="text"]');
        inputs.forEach(input => {
          const value = input.value.trim();
          if (value) {
            amenities.push(value);
          }
        });
      }

      return amenities;
    }

    // Review functions
    let reviewCount = 0;

    function addReviewInput(reviewData = {}) {
      reviewCount++;
      const container = document.getElementById('reviews-inputs');
      if (!container) return;

      const reviewDiv = document.createElement('div');
      reviewDiv.className = 'review-item';
      reviewDiv.style.cssText = 'padding: 1rem; border: 1px solid var(--color-border); border-radius: 8px; background: var(--color-bg-card);';
      reviewDiv.innerHTML = `
        <div style="display: flex; justify-between; align-items: center; margin-bottom: 0.75rem;">
          <strong style="color: var(--color-text);">Review #${reviewCount}</strong>
          <button type="button" onclick="removeReview(this)" style="padding: 0.25rem 0.75rem; background: #ef4444; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 0.85rem;">Remove</button>
        </div>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem; margin-bottom: 0.75rem;">
          <div>
            <label style="display: block; font-weight: 600; font-size: 0.875rem; margin-bottom: 0.25rem; color: var(--color-text-muted);">Customer Name</label>
            <input type="text" class="form-input review-name" value="${reviewData.name || ''}" placeholder="John Doe" style="width: 100%;">
          </div>
          <div>
            <label style="display: block; font-weight: 600; font-size: 0.875rem; margin-bottom: 0.25rem; color: var(--color-text-muted);">Rating</label>
            <select class="form-input review-rating" style="width: 100%;">
              <option value="5" ${reviewData.rating === 5 ? 'selected' : ''}>‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (5 stars)</option>
              <option value="4" ${reviewData.rating === 4 ? 'selected' : ''}>‚≠ê‚≠ê‚≠ê‚≠ê (4 stars)</option>
              <option value="3" ${reviewData.rating === 3 ? 'selected' : ''}>‚≠ê‚≠ê‚≠ê (3 stars)</option>
              <option value="2" ${reviewData.rating === 2 ? 'selected' : ''}>‚≠ê‚≠ê (2 stars)</option>
              <option value="1" ${reviewData.rating === 1 ? 'selected' : ''}>‚≠ê (1 star)</option>
            </select>
          </div>
        </div>
        <div style="margin-bottom: 0.75rem;">
          <label style="display: block; font-weight: 600; font-size: 0.875rem; margin-bottom: 0.25rem; color: var(--color-text-muted);">Review Text</label>
          <textarea class="form-input review-text" rows="3" placeholder="Amazing place! Great hospitality..." style="width: 100%;">${reviewData.text || ''}</textarea>
        </div>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem;">
          <div>
            <label style="display: block; font-weight: 600; font-size: 0.875rem; margin-bottom: 0.25rem; color: var(--color-text-muted);">Date (Optional)</label>
            <input type="date" class="form-input review-date" value="${reviewData.date || ''}" style="width: 100%;">
          </div>
          <div style="display: flex; align-items: center; padding-top: 1.5rem;">
            <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
              <input type="checkbox" class="review-visible" ${reviewData.visible !== false ? 'checked' : ''} style="width: 16px; height: 16px;">
              <span style="font-size: 0.875rem; font-weight: 600; color: var(--color-text-muted);">Show on website</span>
            </label>
          </div>
        </div>
      `;
      container.appendChild(reviewDiv);
    }

    function removeReview(button) {
      const reviewItem = button.closest('.review-item');
      if (reviewItem) {
        reviewItem.remove();
      }
    }

    function collectReviews() {
      const reviews = [];
      const reviewItems = document.querySelectorAll('.review-item');
      console.log('[REVIEWS] Found', reviewItems.length, 'review items');

      reviewItems.forEach(item => {
        const name = item.querySelector('.review-name')?.value.trim();
        const rating = parseInt(item.querySelector('.review-rating')?.value || '5');
        const text = item.querySelector('.review-text')?.value.trim();
        const date = item.querySelector('.review-date')?.value || '';
        const visible = item.querySelector('.review-visible')?.checked !== false;

        console.log('[REVIEWS] Collecting:', { name, rating, text, date, visible });

        if (name && text) {
          reviews.push({
            name: name,
            rating: rating,
            text: text,
            date: date || new Date().toISOString().split('T')[0],
            visible: visible,
            source: 'manual'
          });
        }
      });

      console.log('[REVIEWS] Total collected:', reviews.length, reviews);
      return reviews;
    }

    // Rooms functions
    let roomCount = 0;

    // Common room amenities for checkboxes
    const COMMON_ROOM_AMENITIES = [
      'AC', 'Heater', 'Single Bed', 'Double Bed', 'King Bed', 'Twin Beds',
      'Private Bathroom', 'Attached Bathroom', 'TV', 'WiFi', 'Mini Fridge',
      'Coffee Maker', 'Balcony', 'Sea View', 'Mountain View', 'Garden View',
      'Work Desk', 'Safe', 'Wardrobe', 'Hair Dryer', 'Iron', 'Kettle'
    ];

    function createRoomHTML(roomData = {}, index = null) {
      const roomIndex = index !== null ? index : roomCount++;
      const roomNum = roomIndex + 1;
      const imageUrl = roomData.image || roomData.imageUrl || '';
      const imageId = `roomImage${roomNum}`;
      const uploadId = `roomUpload${roomNum}`;

      return `
        <div class="room-card" data-room-index="${roomIndex}" style="border: 1px solid var(--color-border); border-radius: var(--radius-md); padding: 1rem; background: var(--color-bg-light);">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
            <h4 style="font-weight: 600; color: var(--color-text);">üõèÔ∏è Room Type ${roomNum}</h4>
            <button type="button" onclick="removeRoom(this)" class="btn btn-secondary" style="padding: 0.4rem 0.8rem; background: var(--color-danger);" title="Remove Room">√ó Remove</button>
          </div>

          <!-- Room Image Upload -->
          <div style="margin-bottom: 1rem;">
            <label class="form-label" style="font-size: 0.85rem; margin-bottom: 0.5rem; display: block;">Room Image (Optional)</label>
            <div style="display: flex; gap: 1rem; align-items: start;">
              <div id="${imageId}-preview" style="flex-shrink: 0;">
                ${imageUrl ? `<img src="${imageUrl}" style="width: 120px; height: 80px; object-fit: cover; border-radius: 8px; border: 1px solid var(--color-border);" alt="Room">` : '<div style="width: 120px; height: 80px; background: var(--color-bg); border: 2px dashed var(--color-border); border-radius: 8px; display: flex; align-items: center; justify-content: center; color: var(--color-text-muted); font-size: 0.75rem; text-align: center;">No Image</div>'}
              </div>
              <div style="flex: 1;">
                <input type="hidden" class="room-image" value="${imageUrl}" id="${imageId}">
                <input type="file" id="${uploadId}" accept="image/*" style="display: none;" onchange="handleRoomImageUpload(event, '${imageId}')">
                <button type="button" onclick="document.getElementById('${uploadId}').click()" class="btn btn-secondary" style="font-size: 0.85rem; padding: 0.5rem 1rem;">üì∑ ${imageUrl ? 'Change' : 'Upload'} Image</button>
                ${imageUrl ? `<button type="button" onclick="clearRoomImage('${imageId}')" class="btn btn-secondary" style="font-size: 0.85rem; padding: 0.5rem 1rem; margin-left: 0.5rem; background: var(--color-danger);">√ó Clear</button>` : ''}
                <p style="font-size: 0.75rem; color: var(--color-text-muted); margin-top: 0.25rem;">Max 5MB. If no image, room amenities will be listed as text.</p>
              </div>
            </div>
          </div>

          <!-- Basic Info -->
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 0.75rem; margin-bottom: 1rem;">
            <div>
              <label class="form-label" style="font-size: 0.85rem; margin-bottom: 0.25rem;">Room Name *</label>
              <input type="text" class="form-input room-name" value="${roomData.name || ''}" placeholder="e.g., Deluxe Room" style="padding: 0.6rem;">
            </div>
            <div>
              <label class="form-label" style="font-size: 0.85rem; margin-bottom: 0.25rem;">Price per Night</label>
              <input type="number" class="form-input room-price" value="${roomData.price || ''}" placeholder="2000" style="padding: 0.6rem;">
            </div>
            <div>
              <label class="form-label" style="font-size: 0.85rem; margin-bottom: 0.25rem;">Capacity (guests)</label>
              <input type="number" class="form-input room-capacity" value="${roomData.capacity || ''}" placeholder="2" style="padding: 0.6rem;">
            </div>
            <div>
              <label class="form-label" style="font-size: 0.85rem; margin-bottom: 0.25rem;">Size (sq ft)</label>
              <input type="number" class="form-input room-size" value="${roomData.size || ''}" placeholder="300" style="padding: 0.6rem;">
            </div>
          </div>

          <!-- Description -->
          <div style="margin-bottom: 1rem;">
            <label class="form-label" style="font-size: 0.85rem; margin-bottom: 0.25rem;">Description</label>
            <textarea class="form-input room-description" rows="2" placeholder="Describe the room features..." style="padding: 0.6rem;">${roomData.description || ''}</textarea>
          </div>

          <!-- Room Amenities Checkboxes -->
          <div style="margin-bottom: 1rem;">
            <label class="form-label" style="font-size: 0.85rem; margin-bottom: 0.5rem; display: block;">Room Features & Amenities</label>
            <p style="font-size: 0.75rem; color: var(--color-text-muted); margin-bottom: 0.75rem;">Select all that apply:</p>
            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 0.5rem; margin-bottom: 1rem;">
              ${COMMON_ROOM_AMENITIES.map(amenity => {
                const checked = (roomData.amenities || []).includes(amenity) ? 'checked' : '';
                return `
                  <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; font-size: 0.85rem;">
                    <input type="checkbox" value="${amenity}" class="room-amenity-checkbox" ${checked} style="width: 16px; height: 16px;">
                    <span>${amenity}</span>
                  </label>
                `;
              }).join('')}
            </div>

            <!-- Custom Amenities -->
            <div>
              <label class="form-label" style="font-size: 0.85rem; margin-bottom: 0.5rem; display: block;">Custom Features</label>
              <div class="room-custom-amenities" style="display: flex; flex-direction: column; gap: 0.5rem;">
                ${(roomData.amenities || [])
                  .filter(a => !COMMON_ROOM_AMENITIES.includes(a))
                  .map(amenity => `
                    <div style="display: flex; gap: 0.5rem;">
                      <input type="text" class="form-input room-custom-amenity" value="${amenity}" placeholder="e.g., Jacuzzi, Smart TV" style="flex: 1; padding: 0.5rem; font-size: 0.85rem;">
                      <button type="button" onclick="this.parentElement.remove()" class="btn btn-secondary" style="padding: 0.5rem 0.75rem; background: var(--color-danger);">√ó</button>
                    </div>
                  `).join('')}
              </div>
              <button type="button" onclick="addCustomRoomAmenity(this)" class="btn btn-secondary" style="margin-top: 0.5rem; font-size: 0.85rem; padding: 0.5rem 1rem;">+ Add Custom Feature</button>
            </div>
          </div>
        </div>
      `;
    }

    function addRoomInput(roomData = {}) {
      const container = document.getElementById('rooms-inputs');
      if (!container) return;

      const roomDiv = document.createElement('div');
      roomDiv.innerHTML = createRoomHTML(roomData);
      container.appendChild(roomDiv.firstElementChild);
    }

    function removeRoom(button) {
      if (!confirm('Remove this room?')) return;
      button.closest('.room-card').remove();
    }

    function addCustomRoomAmenity(button) {
      const container = button.previousElementSibling;
      const input = document.createElement('div');
      input.style.cssText = 'display: flex; gap: 0.5rem;';
      input.innerHTML = `
        <input type="text" class="form-input room-custom-amenity" placeholder="e.g., Jacuzzi, Smart TV" style="flex: 1; padding: 0.5rem; font-size: 0.85rem;">
        <button type="button" onclick="this.parentElement.remove()" class="btn btn-secondary" style="padding: 0.5rem 0.75rem; background: var(--color-danger);">√ó</button>
      `;
      container.appendChild(input);
    }

    function clearRoomImage(imageId) {
      document.getElementById(imageId).value = '';
      const previewDiv = document.getElementById(`${imageId}-preview`);
      previewDiv.innerHTML = '<div style="width: 120px; height: 80px; background: var(--color-bg); border: 2px dashed var(--color-border); border-radius: 8px; display: flex; align-items: center; justify-content: center; color: var(--color-text-muted); font-size: 0.75rem; text-align: center;">No Image</div>';

      // Update upload button
      const card = document.getElementById(imageId).closest('.room-card');
      const uploadBtn = card.querySelector('button[onclick*="click"]');
      if (uploadBtn) uploadBtn.textContent = 'üì∑ Upload Image';
    }

    async function handleRoomImageUpload(event, imageId) {
      const file = event.target.files[0];
      if (!file) return;

      if (!file.type.startsWith('image/')) {
        alert('Please upload an image file');
        return;
      }

      if (file.size > 5 * 1024 * 1024) {
        alert('Image size must be less than 5MB');
        return;
      }

      // Show preview immediately
      const reader = new FileReader();
      reader.onload = function(e) {
        const previewDiv = document.getElementById(`${imageId}-preview`);
        previewDiv.innerHTML = `<img src="${e.target.result}" style="width: 120px; height: 80px; object-fit: cover; border-radius: 8px; border: 1px solid var(--color-border);" alt="Room">`;
      };
      reader.readAsDataURL(file);

      // Upload to R2
      try {
        const formData = new FormData();
        formData.append('file', file);

        const response = await fetch(`https://webzyl.com/api/operator/room/upload/${slug}`, {
          method: 'POST',
          body: formData
        });

        const result = await response.json();

        if (response.ok && result.success) {
          document.getElementById(imageId).value = result.imageUrl;
          alert('‚úÖ Room image uploaded successfully!');
        } else {
          alert('‚ùå Upload failed: ' + (result.error || 'Unknown error'));
        }
      } catch (error) {
        console.error('Upload error:', error);
        alert('‚ùå Upload error: ' + error.message);
      }
    }

    function collectRooms() {
      const rooms = [];
      const roomCards = document.querySelectorAll('.room-card');

      roomCards.forEach(card => {
        const name = card.querySelector('.room-name')?.value.trim();
        if (!name) return; // Skip rooms without a name

        const price = card.querySelector('.room-price')?.value;
        const capacity = card.querySelector('.room-capacity')?.value;
        const size = card.querySelector('.room-size')?.value;
        const description = card.querySelector('.room-description')?.value.trim();
        const image = card.querySelector('.room-image')?.value.trim();

        // Collect checked amenities
        const amenities = [];
        card.querySelectorAll('.room-amenity-checkbox:checked').forEach(cb => {
          amenities.push(cb.value);
        });

        // Collect custom amenities
        card.querySelectorAll('.room-custom-amenity').forEach(input => {
          const val = input.value.trim();
          if (val) amenities.push(val);
        });

        const room = {
          name: name,
          price: price ? parseFloat(price) : null,
          capacity: capacity ? parseInt(capacity) : null,
          size: size ? parseFloat(size) : null,
          description: description || '',
          image: image || null,
          amenities: amenities
        };

        rooms.push(room);
      });

      return rooms;
    }

    function loadRoomsFromConfig() {
      const container = document.getElementById('rooms-inputs');
      if (!container) return;

      container.innerHTML = ''; // Clear existing
      roomCount = 0;

      const rooms = config.rooms || [];
      if (rooms.length === 0) {
        // Add one empty room by default
        addRoomInput();
      } else {
        rooms.forEach((room, index) => {
          addRoomInput(room);
        });
      }
    }

    function renderReviewsFromConfig() {
      const container = document.getElementById('reviews-inputs');
      if (!container) return;

      container.innerHTML = ''; // Clear existing
      reviewCount = 0;

      const reviews = config.reviews || [];
      if (reviews.length > 0) {
        reviews.forEach((review) => {
          addReviewInput(review);
        });
      }
    }

    function renderVideosFromConfig() {
      const container = document.getElementById('video-inputs');
      if (!container) return;

      container.innerHTML = '';
      videoCount = 0;

      const list = Array.isArray(config?.videos) ? config.videos : [];
      if (list.length > 0) {
        for (const entry of list) {
          if (typeof entry === 'string') {
            addVideoInput(entry, '');
          } else if (entry && typeof entry === 'object') {
            addVideoInput(entry.url || entry.link || '', entry.thumbnail || entry.thumb || '');
          }
        }
        return;
      }

      const legacyRaw = (config?.embeds?.youtube || '').toString().trim();
      const legacyUrl = extractFirstHttpUrl(legacyRaw);
      if (legacyUrl && isYouTubeUrl(legacyUrl)) {
        addVideoInput(legacyUrl, '');
      } else {
        addVideoInput('', '');
      }
    }

    // Initialize dashboard
    async function initDashboard() {
      try {
        // Get slug from URL
        const params = new URLSearchParams(window.location.search);
        slug = params.get('slug');

        if (!slug) {
          alert('No property slug provided');
          window.location.href = '/operator/login.html';
          return;
        }

        // Fetch config
        await fetchConfig();
        
        // Fetch bookings
        await fetchBookings();

        // Render dashboard
        renderDashboard();

        // Hide loading screen
        document.getElementById('loadingScreen').classList.add('hidden');

      } catch (error) {
        console.error('Dashboard init error:', error);
        const errorDetails = error.message || error.toString();
        alert('Failed to load dashboard: ' + errorDetails + '\n\nPlease check:\n1. Property slug is correct\n2. Property exists in system\n3. Browser console for details');
        document.getElementById('loadingScreen').classList.add('hidden');
        document.body.innerHTML += '<div style="padding: 20px; text-align: center;"><h2>Error Loading Dashboard</h2><p>Slug: ' + slug + '</p><p>Error: ' + errorDetails + '</p><p><a href="?slug=grand-royal">Try grand-royal</a></p></div>';
      }
    }

    async function fetchConfig() {
      // Always load from production origin so the dashboard reflects what the live site uses.
      const response = await fetch(`https://webzyl.com/api/config/${slug}`);
      
      if (!response.ok) {
        throw new Error('Property not found');
      }

      config = await response.json();
      console.log('Config loaded:', config);
    }

    async function fetchBookings() {
      // TODO: Implement bookings API
      // For now, return empty array
      bookings = [];
    }

    function renderDashboard() {
      // Update property name
      document.getElementById('propertyName').textContent = config.name;

      // Update stats
      const status = config.status === 'active' ? 'live' : 'inactive';
      const statusBadge = document.getElementById('statusBadge');
      statusBadge.className = `status-badge ${status}`;
      statusBadge.innerHTML = `
        <span class="status-dot"></span>
        <span>${status.toUpperCase()}</span>
      `;

      document.getElementById('planTier').textContent = capitalizeFirst(config.plan_tier || 'Trial');
      document.getElementById('planPrice').textContent = `‚Çπ${config.plan_price || 0}/month`;

      // Quota stats
      const whatsappUsed = config.quota_whatsapp_used || 0;
      const whatsappLimit = config.quota_whatsapp_monthly || 0;
      const smsUsed = config.quota_sms_used || 0;
      const smsLimit = config.quota_sms_monthly || 0;

      document.getElementById('whatsappQuota').textContent = `${whatsappUsed}/${whatsappLimit}`;
      document.getElementById('smsQuota').textContent = `${smsUsed}/${smsLimit}`;

      const whatsappPercent = whatsappLimit > 0 ? Math.round((whatsappUsed / whatsappLimit) * 100) : 0;
      const smsPercent = smsLimit > 0 ? Math.round((smsUsed / smsLimit) * 100) : 0;

      document.getElementById('whatsappPercent').textContent = `${whatsappPercent}% used`;
      document.getElementById('smsPercent').textContent = `${smsPercent}% used`;

      // Quota bars
      updateQuotaBar('whatsappBar', whatsappUsed, whatsappLimit);
      updateQuotaBar('smsBar', smsUsed, smsLimit);

      document.getElementById('whatsappCount').textContent = `${whatsappUsed}/${whatsappLimit}`;
      document.getElementById('smsCount').textContent = `${smsUsed}/${smsLimit}`;

      // Bookings
      document.getElementById('bookingsMonth').textContent = bookings.length;
      document.getElementById('bookingsTotal').textContent = bookings.length;

      // Website preview
      const websiteUrl = `https://${slug}.webzyl.com`;
      document.getElementById('websitePreview').src = websiteUrl;

      // Last sync
      const lastSync = new Date(config.updatedAt || Date.now()).toLocaleString();
      document.getElementById('lastSync').textContent = lastSync;

      // Settings form
      document.getElementById('settingName').value = config.name || '';
      document.getElementById('settingTagline').value = config.tagline || '';

      // Hero title controls (top-level)
      const heroTitleInput = document.getElementById('settingHeroTitle');
      if (heroTitleInput) heroTitleInput.value = (config.heroTitle || '').toString();
      const heroTitleModeSel = document.getElementById('settingHeroTitleMode');
      if (heroTitleModeSel) {
        const m = String(config.heroTitleMode || '').trim().toLowerCase();
        heroTitleModeSel.value = (m === 'show' || m === 'hide' || m === 'auto') ? m : 'auto';
      }
      const heroTitleModeDesktopSel = document.getElementById('settingHeroTitleModeDesktop');
      if (heroTitleModeDesktopSel) {
        const m = String(config.heroTitleModeDesktop || '').trim().toLowerCase();
        heroTitleModeDesktopSel.value = (m === 'show' || m === 'hide' || m === 'auto') ? m : '';
      }
      const heroTitleModeMobileSel = document.getElementById('settingHeroTitleModeMobile');
      if (heroTitleModeMobileSel) {
        const m = String(config.heroTitleModeMobile || '').trim().toLowerCase();
        heroTitleModeMobileSel.value = (m === 'show' || m === 'hide' || m === 'auto') ? m : '';
      }
      const heroImageContainsBrandSel = document.getElementById('settingHeroImageContainsBrand');
      if (heroImageContainsBrandSel) {
        const raw = config.heroImageContainsBrand;
        const v = (raw === true || String(raw).trim().toLowerCase() === 'true') ? 'true' : 'false';
        heroImageContainsBrandSel.value = v;
      }
      document.getElementById('settingAbout').value = config.about || '';
      document.getElementById('settingPhone').value = config.contact?.phone || '';
      document.getElementById('settingEmail').value = config.contact?.email || '';
      document.getElementById('settingWhatsapp').value = config.contact?.whatsapp || '';

      // Load Super Admin fields
      document.getElementById('settingSlug').value = config.slug || '';
      document.getElementById('currentSlugDisplay').textContent = config.slug || '';
      document.getElementById('settingPlanTier').value = config.plan_tier || 'trial';
      document.getElementById('settingStatus').value = config.status || 'active';
      document.getElementById('settingQuotaWhatsappUsed').value = config.quota_whatsapp_used || 0;
      document.getElementById('settingQuotaWhatsappMonthly').value = config.quota_whatsapp_monthly || 0;
      document.getElementById('settingPlanExpiry').value = config.plan_expiry || '';
      document.getElementById('settingBasePrice').value = config.basePrice || 0;

      // Load Design Profile settings
      document.getElementById('settingDesignProfile').value = config.branding?.designProfileId || '';
      document.getElementById('settingVariant').value = config.variant || '';
      // Load Location
      document.getElementById('settingAddress').value = config.location?.address || '';
      document.getElementById('settingCity').value = config.location?.city || '';
      document.getElementById('settingState').value = config.location?.state || '';
      document.getElementById('settingMapLink').value = config.location?.mapLink || '';
      document.getElementById('settingMapEmbed').value = config.embeds?.map || '';
      // Load Category & Theme
      document.getElementById('settingCategory').value = config.category || '';
      document.getElementById('settingTheme').value = config.templateId || 'ocean-breeze';

      // Show/hide amenities and rooms based on category
      const category = config.category || '';
      const accommodationTypes = ['homestay', 'resort', 'hotel', 'villa', 'cottage'];
      if (accommodationTypes.includes(category.toLowerCase())) {
        document.getElementById('amenitiesSection').style.display = 'block';
        document.getElementById('roomsSection').style.display = 'block';
      } else {
        document.getElementById('amenitiesSection').style.display = 'none';
        document.getElementById('roomsSection').style.display = 'none';
      }

      // Load amenities
      const amenities = config.amenities || [];
      amenities.forEach(amenity => {
        // Check if it's a common amenity checkbox
        const checkbox = Array.from(document.querySelectorAll('.amenity-checkbox')).find(
          cb => cb.value === amenity
        );
        if (checkbox) {
          checkbox.checked = true;
        } else {
          // It's a custom amenity, add it to custom inputs
          addAmenityInput(amenity);
        }
      });

      // Load Pricing
      document.getElementById('settingBasePrice').value = config.basePrice || '';
      // Load Social Media
      document.getElementById('settingFacebook').value = config.social?.facebook || '';
      document.getElementById('settingInstagram').value = config.social?.instagram || '';
      document.getElementById('settingTwitter').value = config.social?.twitter || '';
      document.getElementById('settingYoutube').value = config.social?.youtube || '';
      document.getElementById('settingYoutubeEmbed').value = config.embeds?.youtube || '';

      renderVideosFromConfig();
      loadRoomsFromConfig();
      renderReviewsFromConfig();

        // Hero background (explicit) + legacy hero image
        const hb = (config.heroBackground || config.branding?.heroBackground || null);
        const legacyHeroUrl = (config.heroImage || config.branding?.heroImage || '').toString().trim();
        const hbType = hb && typeof hb === 'object' ? String(hb.type || '').trim().toLowerCase() : '';
        const hbValue = hb && typeof hb === 'object' ? (hb.value == null ? '' : String(hb.value)).trim() : '';

        if (hbType === 'none') {
          setHeroBgTypeInUI('none');
          document.getElementById('settingHeroImage').value = '';
        } else if (hbType === 'preset') {
          setHeroBgTypeInUI('preset');
          const presetInput = document.getElementById('settingHeroBgPreset');
          if (presetInput) presetInput.value = hbValue || 'platform-default';
          document.getElementById('settingHeroImage').value = '';
        } else if (hbType === 'custom') {
          setHeroBgTypeInUI('custom');
          document.getElementById('settingHeroImage').value = hbValue || legacyHeroUrl || '';
        } else {
          // Backward compatible: if site has heroImage -> custom; else -> preset default
          if (legacyHeroUrl) {
            setHeroBgTypeInUI('custom');
            document.getElementById('settingHeroImage').value = legacyHeroUrl;
          } else {
            setHeroBgTypeInUI('preset');
            const presetInput = document.getElementById('settingHeroBgPreset');
            if (presetInput) presetInput.value = 'platform-default';
            document.getElementById('settingHeroImage').value = '';
          }
        }

        // Desktop hero mode (optional; defaults to cover)
        const fitModeRaw = String(config.heroFitMode || config.branding?.heroFitMode || '').trim().toLowerCase();
        const fitMode = (fitModeRaw === 'contain' || fitModeRaw === 'fit' || fitModeRaw === 'nocrop') ? 'contain' : 'cover';
        document.getElementById('settingHeroFitMode').value = fitMode;

        // Mobile hero box (optional; defaults to ON)
        const mobileHeroBoxedRaw = (config.branding && Object.prototype.hasOwnProperty.call(config.branding, 'mobileHeroBoxed'))
          ? config.branding.mobileHeroBoxed
          : config.mobileHeroBoxed;
        const mobileHeroBoxed = (mobileHeroBoxedRaw === false || String(mobileHeroBoxedRaw).trim().toLowerCase() === 'false') ? 'false' : 'true';
        const mobileHeroSelect = document.getElementById('settingMobileHeroBoxed');
        if (mobileHeroSelect) mobileHeroSelect.value = mobileHeroBoxed;

        // Desktop crop focus (optional)
        applyHeroCropFromConfig(config.branding?.heroObjectPosition || config.heroObjectPosition || '');
        syncHeroCropperImage();
        updateHeroCropperVisibility();

        // Hero content position (desktop/mobile)
        const legacyHeroTextPosDesktop = (config.branding?.heroTextPositionDesktop || config.branding?.heroContentPositionDesktop || config.heroTextPositionDesktop || config.heroContentPositionDesktop || '').toString().trim();
        const legacyHeroTextPosMobile = (config.branding?.heroTextPositionMobile || config.branding?.heroContentPositionMobile || config.heroTextPositionMobile || config.heroContentPositionMobile || '').toString().trim();
        document.getElementById('settingHeroTextPositionDesktop').value = legacyHeroTextPosDesktop;
        document.getElementById('settingHeroTextPositionMobile').value = legacyHeroTextPosMobile;

        document.getElementById('settingHeroHeadlinePositionDesktop').value = (config.branding?.heroHeadlinePositionDesktop || config.heroHeadlinePositionDesktop || legacyHeroTextPosDesktop || '').toString().trim();
        document.getElementById('settingHeroHeadlinePositionMobile').value = (config.branding?.heroHeadlinePositionMobile || config.heroHeadlinePositionMobile || legacyHeroTextPosMobile || '').toString().trim();
        document.getElementById('settingHeroTaglinePositionDesktop').value = (config.branding?.heroTaglinePositionDesktop || config.heroTaglinePositionDesktop || '').toString().trim();
        document.getElementById('settingHeroTaglinePositionMobile').value = (config.branding?.heroTaglinePositionMobile || config.heroTaglinePositionMobile || '').toString().trim();
        document.getElementById('settingHeroPrimaryCtaPositionDesktop').value = (config.branding?.heroPrimaryCtaPositionDesktop || config.heroPrimaryCtaPositionDesktop || '').toString().trim();
        document.getElementById('settingHeroPrimaryCtaPositionMobile').value = (config.branding?.heroPrimaryCtaPositionMobile || config.heroPrimaryCtaPositionMobile || '').toString().trim();
        document.getElementById('settingHeroSecondaryCtaPositionDesktop').value = (config.branding?.heroSecondaryCtaPositionDesktop || config.heroSecondaryCtaPositionDesktop || '').toString().trim();
        document.getElementById('settingHeroSecondaryCtaPositionMobile').value = (config.branding?.heroSecondaryCtaPositionMobile || config.heroSecondaryCtaPositionMobile || '').toString().trim();

        document.getElementById('settingWhatsappFloatPositionDesktop').value = (config.branding?.whatsappFloatPositionDesktop || config.whatsappFloatPositionDesktop || '').toString().trim();
        document.getElementById('settingWhatsappFloatPositionMobile').value = (config.branding?.whatsappFloatPositionMobile || config.whatsappFloatPositionMobile || '').toString().trim();

        const primaryActionLabel = (config.branding?.primaryActionLabel || config.primaryActionLabel || '').toString().trim();
        const primaryActionLabelInput = document.getElementById('settingPrimaryActionLabel');
        if (primaryActionLabelInput) primaryActionLabelInput.value = primaryActionLabel;

        document.getElementById('settingHeroTextColor').value = (config.branding?.heroTextColor || config.heroTextColor || '#ffffff').toString().trim() || '#ffffff';
        const heroFontStyle = (config.branding?.heroFontStyle || config.heroFontStyle || '').toString().trim().toLowerCase();
        const heroFontStyleSel = document.getElementById('settingHeroFontStyle');
        if (heroFontStyleSel) heroFontStyleSel.value = heroFontStyle;

        const heroPrimaryCtaFontStyle = (config.branding?.heroPrimaryCtaFontStyle || config.heroPrimaryCtaFontStyle || '').toString().trim().toLowerCase();
        const heroPrimaryCtaFontStyleSel = document.getElementById('settingHeroPrimaryCtaFontStyle');
        if (heroPrimaryCtaFontStyleSel) heroPrimaryCtaFontStyleSel.value = heroPrimaryCtaFontStyle;

        const heroSecondaryCtaFontStyle = (config.branding?.heroSecondaryCtaFontStyle || config.heroSecondaryCtaFontStyle || '').toString().trim().toLowerCase();
        const heroSecondaryCtaFontStyleSel = document.getElementById('settingHeroSecondaryCtaFontStyle');
        if (heroSecondaryCtaFontStyleSel) heroSecondaryCtaFontStyleSel.value = heroSecondaryCtaFontStyle;
        document.getElementById('settingHeroTitleSizeDesktopPx').value = (config.branding?.heroTitleFontSizeDesktopPx || config.heroTitleFontSizeDesktopPx || '').toString().trim();
        document.getElementById('settingHeroTitleSizeMobilePx').value = (config.branding?.heroTitleFontSizeMobilePx || config.heroTitleFontSizeMobilePx || '').toString().trim();
        document.getElementById('settingHeroTaglineSizeDesktopPx').value = (config.branding?.heroTaglineFontSizeDesktopPx || config.heroTaglineFontSizeDesktopPx || '').toString().trim();
        document.getElementById('settingHeroTaglineSizeMobilePx').value = (config.branding?.heroTaglineFontSizeMobilePx || config.heroTaglineFontSizeMobilePx || '').toString().trim();

        updateHeroContentPositionUI();

        // Ensure hero background UI + previews are consistent
        updateHeroBackgroundUI();

        // Header style profile
        const hs = (config.headerStyle || config.branding?.headerStyle || null);
        const hsMode = (hs?.mode || 'auto').toString().trim().toLowerCase();
        const modeEl = document.getElementById('settingHeaderStyleMode');
        if (modeEl) modeEl.value = (hsMode === 'light' || hsMode === 'dark' || hsMode === 'custom') ? hsMode : 'auto';
        const colorEl = document.getElementById('settingHeaderTextColor');
        if (colorEl) colorEl.value = (hs?.textColor || '').toString();
        syncHeaderColorFromText();
        const fontEl = document.getElementById('settingHeaderBrandFontStyle');
        if (fontEl) fontEl.value = (hs?.brandFontStyle || '').toString();
        const weightEl = document.getElementById('settingHeaderBrandFontWeight');
        if (weightEl) weightEl.value = (hs?.brandFontWeight ?? '').toString();
        const sizeEl = document.getElementById('settingHeaderBrandFontSizePx');
        if (sizeEl) sizeEl.value = (hs?.brandFontSizePx ?? '').toString();
        normalizeHeaderDropdowns();
        updateHeaderStyleUI();

        // Logo
        const logoUrl = (config.branding && (config.branding.logoUrl || config.branding.logo)) ? (config.branding.logoUrl || config.branding.logo) : (config.logoUrl || config.logo || '');
        document.getElementById('settingLogoUrl').value = logoUrl || '';
        if (logoUrl) {
          document.getElementById('logoPreview').innerHTML = `
            <div style="display:inline-flex; align-items:center; justify-content:center; padding: 10px; border-radius: 12px; background: rgba(255,255,255,0.08); border: 1px solid var(--color-border);">
              <img src="${logoUrl}" style="max-height: 72px; max-width: 320px; object-fit: contain;" alt="Logo">
            </div>
          `;
        }

      // Gallery
      renderGallery();

      // Quota alert
      if (whatsappPercent >= 90) {
        document.getElementById('quotaAlert').style.display = 'flex';
      } else {
        document.getElementById('quotaAlert').style.display = 'none';
      }
    }

    function updateQuotaBar(barId, used, limit) {
      const percent = limit > 0 ? (used / limit) * 100 : 0;
      const bar = document.getElementById(barId);
      bar.style.width = percent + '%';

      // Color coding
      if (percent >= 90) {
        bar.classList.add('danger');
        bar.classList.remove('warning');
      } else if (percent >= 70) {
        bar.classList.add('warning');
        bar.classList.remove('danger');
      } else {
        bar.classList.remove('warning', 'danger');
      }
    }

    function renderGallery() {
      const galleryGrid = document.getElementById('galleryGrid');
      const gallery = Array.isArray(config.gallery) ? config.gallery : [];

      if (gallery.length === 0) {
        galleryGrid.innerHTML = '<div style="grid-column: 1/-1; text-align: center; padding: 2rem; color: var(--color-text-muted);">No images yet. Upload your first image!</div>';
        return;
      }

      galleryGrid.innerHTML = gallery.map((img, index) => `
        <div class="gallery-item">
          <img src="${img.url || img}" alt="${img.alt || 'Gallery image'}">
          <div class="gallery-item-actions">
            <button class="gallery-action-btn" onclick="deleteGalleryImage(${index})" title="Delete">
              üóëÔ∏è
            </button>
          </div>
        </div>
      `).join('');
    }

    async function handleHeroUpload(event) {
      const file = event.target.files[0];
      if (!file) return;

      // Validate file
      if (!file.type.startsWith('image/')) {
        alert('Please upload an image file');
        return;
      }

      if (file.size > 10 * 1024 * 1024) {
        alert('Image size must be less than 10MB');
        return;
      }

      // Show preview immediately
      const reader = new FileReader();
      reader.onload = function(e) {
        document.getElementById('heroPreview').innerHTML = '<img src="' + e.target.result + '" style="max-width: 100%; max-height: 300px; border-radius: 8px; object-fit: cover;" alt="Hero Image Preview"><p style="color: var(--color-warning); margin-top: 0.5rem;">Uploading...</p>';
        setHeroCropperImage(e.target.result);
      };
      reader.readAsDataURL(file);

      // Upload to R2
      try {
        const formData = new FormData();
        formData.append('file', file);

        const response = await fetch('https://webzyl.com/api/operator/hero/upload/' + slug, {
          method: 'POST',
          body: formData
        });

        const result = await response.json();

        if (response.ok && result.success) {
          // Update with uploaded URL
          document.getElementById('settingHeroImage').value = result.heroUrl;
          document.getElementById('heroPreview').innerHTML = '<img src="' + result.heroUrl + '" style="max-width: 100%; max-height: 300px; border-radius: 8px; object-fit: cover;" alt="Hero Image"><p style="color: var(--color-success); margin-top: 0.5rem;"> Uploaded successfully! Old image deleted.</p>';
          
          // Update local config
          config.heroImage = result.heroUrl;

          // Reset crop to default center on new upload (user can adjust before saving)
          setHeroCrop(50, 50, true);
          setHeroCropperImage(result.heroUrl);
          
          alert(' Hero image uploaded successfully!');
        } else {
          alert(' Upload failed: ' + (result.error || 'Unknown error'));
          document.getElementById('heroPreview').innerHTML = '';
        }
      } catch (error) {
        console.error('Upload error:', error);
        alert(' Upload error: ' + error.message);
        document.getElementById('heroPreview').innerHTML = '';
      }
    }

    async function handleLogoUpload(event) {
      const file = event.target.files[0];
      if (!file) return;

      if (!file.type.startsWith('image/')) {
        alert('Please upload an image file');
        return;
      }

      if (file.size > 5 * 1024 * 1024) {
        alert('Logo image size must be less than 5MB');
        return;
      }

      // Show preview immediately
      const reader = new FileReader();
      reader.onload = function(e) {
        document.getElementById('logoPreview').innerHTML = `
          <div style="display:inline-flex; align-items:center; justify-content:center; padding: 10px; border-radius: 12px; background: rgba(255,255,255,0.08); border: 1px solid var(--color-border);">
            <img src="${e.target.result}" style="max-height: 72px; max-width: 320px; object-fit: contain;" alt="Logo Preview">
          </div>
          <p style="color: var(--color-warning); margin-top: 0.5rem;">Uploading...</p>
        `;
      };
      reader.readAsDataURL(file);

      try {
        const formData = new FormData();
        formData.append('file', file);

        const response = await fetch('https://webzyl.com/api/operator/logo/upload/' + slug, {
          method: 'POST',
          body: formData
        });

        const result = await response.json();

        if (response.ok && result.success) {
          document.getElementById('settingLogoUrl').value = result.logoUrl;
          document.getElementById('logoPreview').innerHTML = `
            <div style="display:inline-flex; align-items:center; justify-content:center; padding: 10px; border-radius: 12px; background: rgba(255,255,255,0.08); border: 1px solid var(--color-border);">
              <img src="${result.logoUrl}" style="max-height: 72px; max-width: 320px; object-fit: contain;" alt="Logo">
            </div>
            <p style="color: var(--color-success); margin-top: 0.5rem;">Uploaded successfully!</p>
          `;

          config.branding = { ...(config.branding || {}), logoUrl: result.logoUrl };
          alert('Logo uploaded successfully!');
        } else {
          alert('Upload failed: ' + (result.error || 'Unknown error'));
          document.getElementById('logoPreview').innerHTML = '';
        }
      } catch (error) {
        console.error('Logo upload error:', error);
        alert('Upload error: ' + error.message);
        document.getElementById('logoPreview').innerHTML = '';
      }
    }

    async function handleGalleryUpload(event) {
      const file = event.target.files[0];
      if (!file) return;

      // Validate file
      if (!file.type.startsWith('image/')) {
        alert('‚ùå Please upload an image file');
        return;
      }

      if (file.size > 10 * 1024 * 1024) {
        alert('‚ùå Image size must be less than 10MB');
        return;
      }

      try {
        // Show upload progress
        const uploadBtn = document.querySelector('.btn-primary');
        const originalText = uploadBtn.textContent;
        uploadBtn.textContent = 'Uploading...';
        uploadBtn.disabled = true;

        // Step 1: Get signed upload URL
        const signResponse = await fetch('https://webzyl.com/api/media/sign-upload', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            tenantId: slug,
            mediaType: 'gallery',
            filename: file.name,
            contentType: file.type,
            size: file.size
          })
        });

        if (!signResponse.ok) {
          const error = await signResponse.json();
          throw new Error(error.error || 'Failed to get upload URL');
        }

        const { uploadUrl, assetId } = await signResponse.json();

        // Step 2: Upload file to R2
        const uploadResponse = await fetch(uploadUrl, {
          method: 'PUT',
          headers: { 'Content-Type': file.type },
          body: file
        });

        if (!uploadResponse.ok) {
          throw new Error('Failed to upload file to storage');
        }

        // Step 3: Confirm upload
        const confirmResponse = await fetch('https://webzyl.com/api/media/confirm-upload', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            tenantId: slug,
            assetId: assetId,
            contentHash: 'uploaded'
          })
        });

        if (!confirmResponse.ok) {
          const error = await confirmResponse.json();
          throw new Error(error.error || 'Failed to confirm upload');
        }

        const { assetUrl } = await confirmResponse.json();

        // Step 4: Add to gallery array and save
        const gallery = Array.isArray(config.gallery) ? config.gallery : [];
        gallery.push({
          url: assetUrl,
          alt: file.name.replace(/\.[^/.]+$/, ''),
          caption: ''
        });
        config.gallery = gallery;

        // Save to backend
        const saveResponse = await fetch('https://webzyl.com/api/operator/update', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            slug: slug,
            gallery: gallery
          })
        });

        const saveResult = await saveResponse.json();

        if (!saveResponse.ok) {
          throw new Error(saveResult.error || 'Failed to save gallery');
        }

        // Success - refresh gallery
        renderGallery();
        alert('‚úÖ Image uploaded successfully!');

      } catch (error) {
        console.error('Upload error:', error);
        alert('‚ùå Upload failed: ' + error.message);
      } finally {
        // Reset upload button
        const uploadBtn = document.querySelector('.btn-primary');
        uploadBtn.textContent = 'üì§ Upload Images';
        uploadBtn.disabled = false;
        // Clear file input
        event.target.value = '';
      }
    }

    async function deleteGalleryImage(index) {
      if (!confirm('Are you sure you want to delete this image?')) return;

      const gallery = Array.isArray(config.gallery) ? config.gallery : [];
      gallery.splice(index, 1);
      config.gallery = gallery;

      // Save to backend immediately
      try {
        const response = await fetch(`https://webzyl.com/api/operator/update`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            slug: slug,
            gallery: gallery
          })
        });

        const result = await response.json();

        if (response.ok) {
          renderGallery();
          alert('‚úÖ Image deleted successfully!');
        } else {
          throw new Error(result.error || 'Failed to delete image');
        }
      } catch (error) {
        console.error('Delete error:', error);
        alert('‚ùå Failed to delete image: ' + error.message);
        // Reload config to revert changes
        location.reload();
      }
    }

    async function saveSettings() {
      const updatedConfig = {
        name: document.getElementById('settingName').value,
        heroTitle: (document.getElementById('settingHeroTitle')?.value || '').toString(),
        heroTitleMode: (document.getElementById('settingHeroTitleMode')?.value || 'auto').toString(),
        heroTitleModeDesktop: (document.getElementById('settingHeroTitleModeDesktop')?.value || '').toString(),
        heroTitleModeMobile: (document.getElementById('settingHeroTitleModeMobile')?.value || '').toString(),
        heroImageContainsBrand: (document.getElementById('settingHeroImageContainsBrand')?.value || 'false').toString().trim().toLowerCase() === 'true',
        tagline: document.getElementById('settingTagline').value,
        about: document.getElementById('settingAbout').value,
        contact: {
          phone: document.getElementById('settingPhone').value,
          email: document.getElementById('settingEmail').value,
          whatsapp: document.getElementById('settingWhatsapp').value
        },
        branding: {
          ...config.branding,
          designProfileId: document.getElementById('settingDesignProfile').value,
          logoUrl: document.getElementById('settingLogoUrl').value,
          heroFitMode: document.getElementById('settingHeroFitMode').value,
          mobileHeroBoxed: (document.getElementById('settingMobileHeroBoxed')?.value === 'true'),
          heroTextPositionDesktop: (document.getElementById('settingHeroTextPositionDesktop')?.value || '').toString().trim(),
          heroTextPositionMobile: (document.getElementById('settingHeroTextPositionMobile')?.value || '').toString().trim(),
          heroHeadlinePositionDesktop: (document.getElementById('settingHeroHeadlinePositionDesktop')?.value || '').toString().trim(),
          heroHeadlinePositionMobile: (document.getElementById('settingHeroHeadlinePositionMobile')?.value || '').toString().trim(),
          heroTaglinePositionDesktop: (document.getElementById('settingHeroTaglinePositionDesktop')?.value || '').toString().trim(),
          heroTaglinePositionMobile: (document.getElementById('settingHeroTaglinePositionMobile')?.value || '').toString().trim(),
          heroPrimaryCtaPositionDesktop: (document.getElementById('settingHeroPrimaryCtaPositionDesktop')?.value || '').toString().trim(),
          heroPrimaryCtaPositionMobile: (document.getElementById('settingHeroPrimaryCtaPositionMobile')?.value || '').toString().trim(),
          heroSecondaryCtaPositionDesktop: (document.getElementById('settingHeroSecondaryCtaPositionDesktop')?.value || '').toString().trim(),
          heroSecondaryCtaPositionMobile: (document.getElementById('settingHeroSecondaryCtaPositionMobile')?.value || '').toString().trim(),
          whatsappFloatPositionDesktop: (document.getElementById('settingWhatsappFloatPositionDesktop')?.value || '').toString().trim(),
          whatsappFloatPositionMobile: (document.getElementById('settingWhatsappFloatPositionMobile')?.value || '').toString().trim(),
          primaryActionLabel: (document.getElementById('settingPrimaryActionLabel')?.value || '').toString().trim(),
          heroTextColor: (document.getElementById('settingHeroTextColor')?.value || '').toString().trim(),
          heroFontStyle: (document.getElementById('settingHeroFontStyle')?.value || '').toString().trim(),
          heroPrimaryCtaFontStyle: (document.getElementById('settingHeroPrimaryCtaFontStyle')?.value || '').toString().trim(),
          heroSecondaryCtaFontStyle: (document.getElementById('settingHeroSecondaryCtaFontStyle')?.value || '').toString().trim(),
          heroTitleFontSizeDesktopPx: (document.getElementById('settingHeroTitleSizeDesktopPx')?.value || '').toString().trim(),
          heroTitleFontSizeMobilePx: (document.getElementById('settingHeroTitleSizeMobilePx')?.value || '').toString().trim(),
          heroTaglineFontSizeDesktopPx: (document.getElementById('settingHeroTaglineSizeDesktopPx')?.value || '').toString().trim(),
          heroTaglineFontSizeMobilePx: (document.getElementById('settingHeroTaglineSizeMobilePx')?.value || '').toString().trim(),
          heroObjectPosition: document.getElementById('settingHeroObjectPosition').value
        },
        variant: document.getElementById('settingVariant').value,
        location: {
          address: document.getElementById('settingAddress').value,
          city: document.getElementById('settingCity').value,
          state: document.getElementById('settingState').value,
          mapLink: document.getElementById('settingMapLink').value
        },
        embeds: {
          map: document.getElementById('settingMapEmbed').value,
          youtube: document.getElementById('settingYoutubeEmbed').value
        },
        videos: collectVideos(),
        category: document.getElementById('settingCategory').value,
        amenities: collectAmenities(),
        rooms: collectRooms(),
        reviews: collectReviews(),
        templateId: document.getElementById('settingTheme').value,
        basePrice: parseInt(document.getElementById('settingBasePrice').value) || 0,

        // Super Admin fields
        plan_tier: document.getElementById('settingPlanTier').value,
        status: document.getElementById('settingStatus').value,
        quota_whatsapp_used: parseInt(document.getElementById('settingQuotaWhatsappUsed').value) || 0,
        quota_whatsapp_monthly: parseInt(document.getElementById('settingQuotaWhatsappMonthly').value) || 0,
        plan_expiry: document.getElementById('settingPlanExpiry').value,
        headerStyle: (() => {
          const mode = (document.getElementById('settingHeaderStyleMode')?.value || 'auto').toString().trim().toLowerCase();
          const okMode = (mode === 'auto' || mode === 'light' || mode === 'dark' || mode === 'custom') ? mode : 'auto';
          const hs = { mode: okMode };
          if (okMode === 'custom') {
            hs.textColor = (document.getElementById('settingHeaderTextColor')?.value || '').toString().trim();
            hs.brandFontStyle = (document.getElementById('settingHeaderBrandFontStyle')?.value || '').toString().trim();
            hs.brandFontWeight = (document.getElementById('settingHeaderBrandFontWeight')?.value || '').toString().trim();
            hs.brandFontSizePx = (document.getElementById('settingHeaderBrandFontSizePx')?.value || '').toString().trim();
          }
          return hs;
        })(),
        heroBackground: (() => {
          const hb = getHeroBackgroundFromUI();
          return { type: hb.type, value: hb.value };
        })(),
        social: {
          facebook: document.getElementById('settingFacebook').value,
          instagram: document.getElementById('settingInstagram').value,
          twitter: document.getElementById('settingTwitter').value,
          youtube: document.getElementById('settingYoutube').value
        }
      };

      // Backward-compat: older worker versions only understand `heroImage`.
      // Only send it when operator explicitly uses a custom image.
      try {
        const hb = getHeroBackgroundFromUI();
        if (hb && hb.type === 'custom' && hb.value) {
          updatedConfig.heroImage = String(hb.value);
        }
      } catch (e) {
        // Ignore UI parsing issues; do not block save.
      }

      // Call the update API
      try {
        const response = await fetch('https://webzyl.com/api/operator/update/' + slug, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(updatedConfig)
        });

        const result = await response.json();

        if (response.ok && result.success) {
          alert(' Changes published successfully! Your website has been updated.');
          // Update local config
          config = result.config;
          // Optionally refresh to show latest data
          setTimeout(() => window.location.reload(), 1000);
        } else {
          alert(' Error: ' + (result.error || 'Failed to save changes'));
        }
      } catch (error) {
        console.error('Save error:', error);
        alert(' Network error: ' + error.message);
      }
    }

    function refreshDashboard() {
      window.location.reload();
    }

    function logout() {
      window.location.href = '/operator/login.html';
    }

    function openWebsite() {
      window.open(`https://${slug}.webzyl.com`, '_blank');
    }

    function copyWebsiteLink() {
      const url = `https://${slug}.webzyl.com`;
      navigator.clipboard.writeText(url);
      alert('Link copied to clipboard!');
    }

    function shareWebsite() {
      const url = `https://${slug}.webzyl.com`;
      if (navigator.share) {
        navigator.share({
          title: config.name,
          text: config.tagline,
          url: url
        });
      } else {
        copyWebsiteLink();
      }
    }

    function exportBookings() {
      alert('Export functionality coming soon!');
    }

    function resetQuota() {
      alert('Quota reset is handled automatically on the 1st of each month');
    }

    function capitalizeFirst(str) {
      return str.charAt(0).toUpperCase() + str.slice(1);
    }

    // =============================
    // Hero Desktop Cropper Helpers
    // Stores a safe object-position like "50% 35%" in #settingHeroObjectPosition
    // =============================

    function clamp(n, min, max) {
      return Math.max(min, Math.min(max, n));
    }

    function parseHeroObjectPositionToXY(value) {
      const v = String(value || '').trim().toLowerCase();
      if (!v || v === 'center') return { x: 50, y: 50 };
      const preset = {
        top: { x: 50, y: 0 },
        bottom: { x: 50, y: 100 },
        left: { x: 0, y: 50 },
        right: { x: 100, y: 50 },
        'center top': { x: 50, y: 0 },
        'center bottom': { x: 50, y: 100 },
        'left top': { x: 0, y: 0 },
        'left bottom': { x: 0, y: 100 },
        'right top': { x: 100, y: 0 },
        'right bottom': { x: 100, y: 100 }
      };
      if (preset[v]) return preset[v];
      const m = v.match(/^(\d{1,3})%\s+(\d{1,3})%$/);
      if (m) {
        return {
          x: clamp(parseInt(m[1], 10), 0, 100),
          y: clamp(parseInt(m[2], 10), 0, 100)
        };
      }
      return { x: 50, y: 50 };
    }

    function formatHeroObjectPosition(x, y) {
      const xi = clamp(Math.round(x), 0, 100);
      const yi = clamp(Math.round(y), 0, 100);
      // Keep default empty so existing sites remain unchanged unless user adjusts.
      if (xi === 50 && yi === 50) return '';
      return `${xi}% ${yi}%`;
    }

    function setHeroCrop(x, y, persist = true) {
      const cropper = document.getElementById('heroCropper');
      const xInput = document.getElementById('heroCropX');
      const yInput = document.getElementById('heroCropY');
      const xVal = document.getElementById('heroCropXVal');
      const yVal = document.getElementById('heroCropYVal');
      const hidden = document.getElementById('settingHeroObjectPosition');
      if (!cropper || !xInput || !yInput || !xVal || !yVal || !hidden) return;

      const xi = clamp(Math.round(x), 0, 100);
      const yi = clamp(Math.round(y), 0, 100);

      cropper.style.backgroundPosition = `${xi}% ${yi}%`;
      xInput.value = String(xi);
      yInput.value = String(yi);
      xVal.textContent = `${xi}%`;
      yVal.textContent = `${yi}%`;

      if (persist) {
        hidden.value = formatHeroObjectPosition(xi, yi);
      }
    }

    function resetHeroCrop() {
      setHeroCrop(50, 50, true);
    }

    function setHeroCropperImage(src) {
      const cropper = document.getElementById('heroCropper');
      if (!cropper) return;
      if (!src) {
        cropper.style.backgroundImage = 'none';
        return;
      }
      cropper.style.backgroundImage = `url('${src}')`;
    }

    const HERO_BG_PRESETS = [
      { id: 'platform-default', label: 'Default', url: 'https://images.unsplash.com/photo-1566073771259-6a8506099945' },
      { id: 'minimal-light-01', label: 'Minimal', url: 'https://images.unsplash.com/photo-1526498460520-4c246339dccb' },
      { id: 'nature-01', label: 'Nature', url: 'https://images.unsplash.com/photo-1501785888041-af3ef285b470' },
      { id: 'luxury-01', label: 'Luxury', url: 'https://images.unsplash.com/photo-1542314831-068cd1dbfeeb' },
      { id: 'beach-01', label: 'Beach', url: 'https://images.unsplash.com/photo-1500375592092-40eb2168fd21' }
    ];

    function getHeroBgPresetUrl(presetId) {
      const id = (presetId || '').toString().trim();
      const found = HERO_BG_PRESETS.find(p => p.id === id);
      return (found ? found.url : HERO_BG_PRESETS[0].url);
    }

    function getHeroBgTypeFromUI() {
      const n = document.querySelector('input[name="heroBgType"]:checked');
      const v = (n?.value || '').toString().trim().toLowerCase();
      return (v === 'none' || v === 'preset' || v === 'custom') ? v : 'preset';
    }

    function setHeroBgTypeInUI(type) {
      const t = (type || '').toString().trim().toLowerCase();
      const v = (t === 'none' || t === 'preset' || t === 'custom') ? t : 'preset';
      const el = document.getElementById(v === 'none' ? 'settingHeroBgTypeNone' : v === 'custom' ? 'settingHeroBgTypeCustom' : 'settingHeroBgTypePreset');
      if (el) el.checked = true;
    }

    function getHeroBackgroundFromUI() {
      const type = getHeroBgTypeFromUI();
      if (type === 'none') return { type: 'none', value: null, hasImage: false, url: '' };
      if (type === 'preset') {
        const id = (document.getElementById('settingHeroBgPreset')?.value || 'platform-default').toString().trim();
        return { type: 'preset', value: id || 'platform-default', hasImage: true, url: getHeroBgPresetUrl(id || 'platform-default') };
      }
      const url = (document.getElementById('settingHeroImage')?.value || '').toString().trim();
      return url
        ? { type: 'custom', value: url, hasImage: true, url }
        : { type: 'none', value: null, hasImage: false, url: '' };
    }

    function renderHeroBgPresetGrid() {
      const grid = document.getElementById('heroBgPresetGrid');
      if (!grid) return;
      const selected = (document.getElementById('settingHeroBgPreset')?.value || 'platform-default').toString().trim();
      grid.innerHTML = HERO_BG_PRESETS.map(p => {
        const active = p.id === selected;
        const border = active ? '2px solid var(--color-primary)' : '1px solid var(--color-border)';
        return `
          <button type="button" onclick="selectHeroBgPreset('${p.id}')" style="text-align:left; background: transparent; border: ${border}; border-radius: 12px; overflow:hidden; cursor:pointer; padding:0;">
            <div style="height: 64px; background-image:url('${p.url}?w=420&q=85'); background-size: cover; background-position: center;"></div>
            <div style="padding: 8px 10px; font-size: 0.9rem; color: var(--color-text);">${p.label}</div>
          </button>
        `;
      }).join('');
    }

    function selectHeroBgPreset(id) {
      const input = document.getElementById('settingHeroBgPreset');
      if (input) input.value = (id || 'platform-default').toString();
      renderHeroBgPresetGrid();
      updateHeroBackgroundUI();
    }

    function updateHeroBackgroundUI() {
      const type = getHeroBgTypeFromUI();
      const presetWrap = document.getElementById('heroBgPresetWrap');
      const heroUrlGroup = document.getElementById('settingHeroImage')?.closest('.form-group');
      const uploadBtn = document.getElementById('heroUploadBtn');
      if (presetWrap) presetWrap.style.display = (type === 'preset') ? 'block' : 'none';
      if (heroUrlGroup) heroUrlGroup.style.display = (type === 'custom') ? '' : 'none';
      if (uploadBtn) {
        uploadBtn.style.display = (type === 'custom') ? '' : 'none';
      }

      if (type === 'preset') {
        renderHeroBgPresetGrid();
      }

      // Update preview
      const preview = document.getElementById('heroPreview');
      const hb = getHeroBackgroundFromUI();
      if (preview) {
        if (hb.hasImage && hb.url) {
          preview.innerHTML = `<img src="${hb.url}" style="max-width: 100%; max-height: 300px; border-radius: 8px; object-fit: cover;" alt="Hero Background">`;
        } else {
          preview.innerHTML = `<div style="width: 100%; max-width: 900px; height: 180px; border-radius: 12px; background: #ffffff; border: 1px solid var(--color-border);"></div>`;
        }
      }

      // Keep tools in sync
      setHeroCropperImage(hb.hasImage ? hb.url : '');
      syncHeroTextPosImage();
      updateHeroCropperVisibility();
    }

    function updateHeaderStyleUI() {
      const mode = (document.getElementById('settingHeaderStyleMode')?.value || 'auto').toString().trim().toLowerCase();
      const wrap = document.getElementById('headerStyleCustomWrap');
      if (wrap) wrap.style.display = (mode === 'custom') ? 'block' : 'none';
    }

    function normalizeHeaderDropdowns() {
      const weightEl = document.getElementById('settingHeaderBrandFontWeight');
      if (weightEl) {
        const raw = (weightEl.value || '').toString().trim();
        if (raw && !Array.from(weightEl.options).some(o => o.value === raw)) {
          // Map to nearest common value
          const n = Number(raw);
          if (Number.isFinite(n)) {
            const options = [500, 600, 700, 800];
            let best = options[0];
            let bestDist = Math.abs(n - best);
            for (const opt of options) {
              const d = Math.abs(n - opt);
              if (d < bestDist) { best = opt; bestDist = d; }
            }
            weightEl.value = String(best);
          } else {
            weightEl.value = '';
          }
        }
      }

      const sizeEl = document.getElementById('settingHeaderBrandFontSizePx');
      if (sizeEl) {
        const raw = (sizeEl.value || '').toString().trim();
        if (raw && !Array.from(sizeEl.options).some(o => o.value === raw)) {
          const n = Number(raw);
          if (Number.isFinite(n)) {
            const options = [20, 24, 28, 32];
            let best = options[0];
            let bestDist = Math.abs(n - best);
            for (const opt of options) {
              const d = Math.abs(n - opt);
              if (d < bestDist) { best = opt; bestDist = d; }
            }
            sizeEl.value = String(best);
          } else {
            sizeEl.value = '';
          }
        }
      }
    }

    function syncHeaderColorFromPicker() {
      const picker = document.getElementById('settingHeaderTextColorPicker');
      const text = document.getElementById('settingHeaderTextColor');
      if (!picker || !text) return;
      const v = (picker.value || '').toString().trim();
      if (v) text.value = v;
    }

    function syncHeaderColorFromText() {
      const picker = document.getElementById('settingHeaderTextColorPicker');
      const text = document.getElementById('settingHeaderTextColor');
      if (!picker || !text) return;
      const raw = (text.value || '').toString().trim();
      const v = raw.startsWith('#') ? raw : (raw ? `#${raw}` : '');
      if (/^#([0-9a-fA-F]{6})$/.test(v)) {
        picker.value = v;
      }
    }

    function syncHeroCropperImage() {
      const hb = getHeroBackgroundFromUI();
      setHeroCropperImage(hb.hasImage ? hb.url : '');
    }

    // =====================================================
    // Hero Text & Buttons Position (Desktop/Mobile)
    // Stores a safe percent pair like "50% 35%".
    // =====================================================
    function syncHeroTextPosImage() {
      const bg = document.getElementById('heroTextPosBg');
      if (!bg) return;
      const hb = getHeroBackgroundFromUI();
      bg.style.backgroundImage = (hb.hasImage && hb.url) ? `url('${hb.url}')` : '';
    }

    function parsePercentPair(value) {
      const raw = (value || '').toString().trim();
      if (!raw) return null;
      const m = raw.match(/^\s*(\d{1,3})(?:\s*%?)\s+(\d{1,3})(?:\s*%?)\s*$/);
      if (!m) return null;
      const clamp = (n) => Math.max(0, Math.min(100, n));
      const x = clamp(Number(m[1]));
      const y = clamp(Number(m[2]));
      if (!Number.isFinite(x) || !Number.isFinite(y)) return null;
      return { x, y };
    }

    function formatPercentPair(x, y) {
      const clamp = (n) => Math.max(0, Math.min(100, Math.round(n)));
      return `${clamp(x)}% ${clamp(y)}%`;
    }

    function getHeroContentTarget() {
      return (document.getElementById('settingHeroContentTarget')?.value || 'desktop').toString();
    }

    function getHeroContentItem() {
      return (document.getElementById('settingHeroContentItem')?.value || 'headline').toString();
    }

    function getHeroContentHidden(target, item) {
      const t = target === 'mobile' ? 'Mobile' : 'Desktop';
      if (item === 'headline') return document.getElementById(`settingHeroHeadlinePosition${t}`);
      if (item === 'tagline') return document.getElementById(`settingHeroTaglinePosition${t}`);
      if (item === 'primary') return document.getElementById(`settingHeroPrimaryCtaPosition${t}`);
      if (item === 'secondary') return document.getElementById(`settingHeroSecondaryCtaPosition${t}`);
      if (item === 'whatsapp') return document.getElementById(`settingWhatsappFloatPosition${t}`);
      return document.getElementById(`settingHeroTextPosition${t}`);
    }

    function setHeroContentPosFromXY(x, y) {
      const target = getHeroContentTarget();
      const item = getHeroContentItem();
      const hidden = getHeroContentHidden(target, item);
      if (hidden) hidden.value = formatPercentPair(x, y);
      updateHeroContentPositionUI();
    }

    function setHeroContentPosEmpty() {
      const target = getHeroContentTarget();
      const item = getHeroContentItem();
      const hidden = getHeroContentHidden(target, item);
      if (hidden) hidden.value = '';
      updateHeroContentPositionUI();
    }

    function updateHeroContentPositionUI() {
      const wrap = document.getElementById('heroTextPos');
      const headline = document.getElementById('heroTextPosHeadline');
      const tagline = document.getElementById('heroTextPosTagline');
      const primary = document.getElementById('heroTextPosPrimary');
      const secondary = document.getElementById('heroTextPosSecondary');
      const whatsapp = document.getElementById('heroTextPosWhatsapp');
      const xSlider = document.getElementById('heroTextPosX');
      const ySlider = document.getElementById('heroTextPosY');
      const xVal = document.getElementById('heroTextPosXVal');
      const yVal = document.getElementById('heroTextPosYVal');
      const status = document.getElementById('heroTextPosStatus');
      if (!wrap || !headline || !tagline || !primary || !secondary || !whatsapp || !xSlider || !ySlider || !xVal || !yVal) return;

      const target = getHeroContentTarget();
      const item = getHeroContentItem();
      wrap.classList.toggle('desktop', target === 'desktop');
      wrap.classList.toggle('mobile', target === 'mobile');

      syncHeroTextPosImage();

      const heroTitleRaw = (document.getElementById('settingHeroTitle')?.value || '').toString();
      const nameText = (heroTitleRaw.trim() || (document.getElementById('settingName')?.value || config.name || '')).toString().trim() || 'Headline';
      const taglineText = (document.getElementById('settingTagline')?.value || config.tagline || 'Tagline').toString().trim() || 'Tagline';
      const primaryLabelText = (document.getElementById('settingPrimaryActionLabel')?.value || 'Primary').toString().trim() || 'Primary';
      headline.textContent = nameText;
      tagline.textContent = taglineText;
      primary.textContent = primaryLabelText;

      // Visual show/hide of hero headline (mirrors SSR behavior)
      const modeDefault = (document.getElementById('settingHeroTitleMode')?.value || 'auto').toString().trim().toLowerCase();
      const modeOverride = (target === 'mobile'
        ? (document.getElementById('settingHeroTitleModeMobile')?.value || '')
        : (document.getElementById('settingHeroTitleModeDesktop')?.value || '')
      ).toString().trim().toLowerCase();
      const mode = (modeOverride === 'show' || modeOverride === 'hide' || modeOverride === 'auto')
        ? modeOverride
        : (modeDefault === 'show' || modeDefault === 'hide' || modeDefault === 'auto')
          ? modeDefault
          : 'auto';
      const containsBrand = (document.getElementById('settingHeroImageContainsBrand')?.value || 'false').toString().trim().toLowerCase() === 'true';
      const hasLogo = Boolean((document.getElementById('settingLogoUrl')?.value || config.branding?.logoUrl || config.logoUrl || config.branding?.logo || config.logo || '').toString().trim());
      const showHeadline = mode === 'hide'
        ? false
        : mode === 'show'
          ? true
          : !(containsBrand && hasLogo);
      headline.style.display = showHeadline ? '' : 'none';

      const applyItemPos = (el, hiddenValue, defaultX, defaultY) => {
        const parsed = parsePercentPair(hiddenValue);
        const x = parsed ? parsed.x : defaultX;
        const y = parsed ? parsed.y : defaultY;
        el.style.left = `${x}%`;
        el.style.top = `${y}%`;
        return { parsed, x, y };
      };

      const hHidden = getHeroContentHidden(target, 'headline')?.value || '';
      const tHidden = getHeroContentHidden(target, 'tagline')?.value || '';
      const pHidden = getHeroContentHidden(target, 'primary')?.value || '';
      const sHidden = getHeroContentHidden(target, 'secondary')?.value || '';
      const wHidden = getHeroContentHidden(target, 'whatsapp')?.value || '';

      applyItemPos(headline, hHidden, 50, 46);
      applyItemPos(tagline, tHidden, 50, 58);
      applyItemPos(primary, pHidden, 50, 70);
      applyItemPos(secondary, sHidden, 50, 78);
      applyItemPos(whatsapp, wHidden, 92, 88);

      const activeHidden = getHeroContentHidden(target, item);
      const active = parsePercentPair(activeHidden?.value || '');
      const activeDefault = item === 'primary'
        ? { x: 50, y: 70 }
        : item === 'secondary'
          ? { x: 50, y: 78 }
          : item === 'tagline'
            ? { x: 50, y: 58 }
            : item === 'whatsapp'
              ? { x: 92, y: 88 }
              : { x: 50, y: 46 };
      const ax = active ? active.x : activeDefault.x;
      const ay = active ? active.y : activeDefault.y;

      xSlider.value = String(ax);
      ySlider.value = String(ay);
      xVal.textContent = `${ax}%`;
      yVal.textContent = `${ay}%`;

      if (status) status.textContent = active ? `Custom: ${formatPercentPair(ax, ay)}` : 'Default (not overridden)';
      if (status && item === 'headline' && !showHeadline) status.textContent = 'Hidden by Hero Title Mode';

      // Text preview style
      const color = (document.getElementById('settingHeroTextColor')?.value || '#ffffff').toString();
      headline.style.color = color;
      tagline.style.color = color;
      primary.style.color = color;
      secondary.style.color = color;
      whatsapp.style.color = color;

      const fontKey = (document.getElementById('settingHeroFontStyle')?.value || '').toString().trim().toLowerCase();
      const mapFont = (k) => {
        if (!k) return '';
        if (k === 'modern') return 'ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Arial, "Noto Sans", "Liberation Sans", sans-serif';
        if (k === 'classic') return 'ui-serif, Georgia, "Times New Roman", Times, serif';
        if (k === 'elegant') return 'ui-serif, "Palatino Linotype", Palatino, Georgia, serif';
        if (k === 'mono') return 'ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace';
        return '';
      };
      wrap.style.fontFamily = mapFont(fontKey);

      const pFontKey = (document.getElementById('settingHeroPrimaryCtaFontStyle')?.value || '').toString().trim().toLowerCase();
      const sFontKey = (document.getElementById('settingHeroSecondaryCtaFontStyle')?.value || '').toString().trim().toLowerCase();
      primary.style.fontFamily = mapFont(pFontKey) || '';
      secondary.style.fontFamily = mapFont(sFontKey) || '';

      const d = target === 'mobile' ? 'Mobile' : 'Desktop';
      const titlePx = (document.getElementById(`settingHeroTitleSize${d}Px`)?.value || '').toString().trim();
      const subPx = (document.getElementById(`settingHeroTaglineSize${d}Px`)?.value || '').toString().trim();
      headline.style.fontSize = titlePx ? `${Number(titlePx)}px` : '';
      tagline.style.fontSize = subPx ? `${Number(subPx)}px` : '';

      // Sync style sliders
      syncHeroTextStyleUI();
    }

    function onHeroContentPosSlider() {
      const x = Number(document.getElementById('heroTextPosX')?.value || 50);
      const y = Number(document.getElementById('heroTextPosY')?.value || 50);
      setHeroContentPosFromXY(x, y);
    }

    function resetHeroContentPos() {
      setHeroContentPosEmpty();
    }

    function resetHeroAll() {
      if (!confirm('Reset ALL hero text/buttons/WhatsApp positions and style overrides?')) return;

      const idsToClear = [
        // Legacy single-block positions
        'settingHeroTextPositionDesktop',
        'settingHeroTextPositionMobile',

        // New separated positions
        'settingHeroHeadlinePositionDesktop',
        'settingHeroHeadlinePositionMobile',
        'settingHeroTaglinePositionDesktop',
        'settingHeroTaglinePositionMobile',
        'settingHeroPrimaryCtaPositionDesktop',
        'settingHeroPrimaryCtaPositionMobile',
        'settingHeroSecondaryCtaPositionDesktop',
        'settingHeroSecondaryCtaPositionMobile',
        'settingWhatsappFloatPositionDesktop',
        'settingWhatsappFloatPositionMobile',

        // Text style overrides
        'settingHeroTitleSizeDesktopPx',
        'settingHeroTitleSizeMobilePx',
        'settingHeroTaglineSizeDesktopPx',
        'settingHeroTaglineSizeMobilePx'
      ];

      for (const id of idsToClear) {
        const el = document.getElementById(id);
        if (el) el.value = '';
      }

      const color = document.getElementById('settingHeroTextColor');
      if (color) color.value = '#ffffff';

      const fontSel = document.getElementById('settingHeroFontStyle');
      if (fontSel) fontSel.value = '';

      const pFontSel = document.getElementById('settingHeroPrimaryCtaFontStyle');
      if (pFontSel) pFontSel.value = '';

      const sFontSel = document.getElementById('settingHeroSecondaryCtaFontStyle');
      if (sFontSel) sFontSel.value = '';

      const primaryLabel = document.getElementById('settingPrimaryActionLabel');
      if (primaryLabel) primaryLabel.value = '';

      const itemSel = document.getElementById('settingHeroContentItem');
      if (itemSel) itemSel.value = 'headline';

      updateHeroContentPositionUI();
    }

    function syncHeroTextStyleUI() {
      const target = getHeroContentTarget();
      const d = target === 'mobile' ? 'Mobile' : 'Desktop';
      const titleSlider = document.getElementById('heroTitleSize');
      const tagSlider = document.getElementById('heroTaglineSize');
      const titleVal = document.getElementById('heroTitleSizeVal');
      const tagVal = document.getElementById('heroTaglineSizeVal');
      if (!titleSlider || !tagSlider || !titleVal || !tagVal) return;

      const titleHidden = document.getElementById(`settingHeroTitleSize${d}Px`);
      const tagHidden = document.getElementById(`settingHeroTaglineSize${d}Px`);

      const titlePx = Number((titleHidden?.value || titleSlider.value || 56).toString().trim() || 56);
      const tagPx = Number((tagHidden?.value || tagSlider.value || 18).toString().trim() || 18);

      titleSlider.value = String(titlePx);
      tagSlider.value = String(tagPx);
      titleVal.textContent = `${titlePx}px`;
      tagVal.textContent = `${tagPx}px`;
    }

    function onHeroTextStyleSlider() {
      const target = getHeroContentTarget();
      const d = target === 'mobile' ? 'Mobile' : 'Desktop';
      const titleSlider = document.getElementById('heroTitleSize');
      const tagSlider = document.getElementById('heroTaglineSize');
      const titleHidden = document.getElementById(`settingHeroTitleSize${d}Px`);
      const tagHidden = document.getElementById(`settingHeroTaglineSize${d}Px`);
      if (titleHidden && titleSlider) titleHidden.value = String(parseInt(titleSlider.value, 10));
      if (tagHidden && tagSlider) tagHidden.value = String(parseInt(tagSlider.value, 10));
      syncHeroTextStyleUI();
      updateHeroContentPositionUI();
    }

    function resetHeroTextStyle() {
      const color = document.getElementById('settingHeroTextColor');
      if (color) color.value = '#ffffff';

      const fontSel = document.getElementById('settingHeroFontStyle');
      if (fontSel) fontSel.value = '';

      const pFontSel = document.getElementById('settingHeroPrimaryCtaFontStyle');
      if (pFontSel) pFontSel.value = '';

      const sFontSel = document.getElementById('settingHeroSecondaryCtaFontStyle');
      if (sFontSel) sFontSel.value = '';
      const ids = [
        'settingHeroTitleSizeDesktopPx',
        'settingHeroTitleSizeMobilePx',
        'settingHeroTaglineSizeDesktopPx',
        'settingHeroTaglineSizeMobilePx'
      ];
      for (const id of ids) {
        const el = document.getElementById(id);
        if (el) el.value = '';
      }
      updateHeroContentPositionUI();
    }

    function attachHeroTextPosEvents() {
      const wrap = document.getElementById('heroTextPos');
      const headline = document.getElementById('heroTextPosHeadline');
      const tagline = document.getElementById('heroTextPosTagline');
      const primary = document.getElementById('heroTextPosPrimary');
      const secondary = document.getElementById('heroTextPosSecondary');
      const whatsapp = document.getElementById('heroTextPosWhatsapp');
      const heroUrlInput = document.getElementById('settingHeroImage');
      if (!wrap || !headline || !tagline || !primary || !secondary || !whatsapp) return;

      if (heroUrlInput) {
        heroUrlInput.addEventListener('change', () => syncHeroTextPosImage());
        heroUrlInput.addEventListener('blur', () => syncHeroTextPosImage());
      }

      let dragging = false;
      let draggingItem = 'headline';

      const setFromEvent = (ev) => {
        const rect = wrap.getBoundingClientRect();
        const x = ((ev.clientX - rect.left) / rect.width) * 100;
        const y = ((ev.clientY - rect.top) / rect.height) * 100;
        const clamp = (n) => Math.max(0, Math.min(100, n));
        const itemSel = document.getElementById('settingHeroContentItem');
        if (itemSel) itemSel.value = draggingItem;
        setHeroContentPosFromXY(clamp(x), clamp(y));
      };

      const beginDrag = (el, item, ev) => {
        dragging = true;
        draggingItem = item;
        el.classList.add('dragging');
        el.setPointerCapture?.(ev.pointerId);
        const itemSel = document.getElementById('settingHeroContentItem');
        if (itemSel) itemSel.value = item;
        setFromEvent(ev);
        updateHeroContentPositionUI();
      };

      headline.addEventListener('pointerdown', (ev) => beginDrag(headline, 'headline', ev));
      tagline.addEventListener('pointerdown', (ev) => beginDrag(tagline, 'tagline', ev));
      primary.addEventListener('pointerdown', (ev) => beginDrag(primary, 'primary', ev));
      secondary.addEventListener('pointerdown', (ev) => beginDrag(secondary, 'secondary', ev));
      whatsapp.addEventListener('pointerdown', (ev) => beginDrag(whatsapp, 'whatsapp', ev));

      window.addEventListener('pointermove', (ev) => {
        if (!dragging) return;
        setFromEvent(ev);
      });

      const stop = () => {
        dragging = false;
        headline.classList.remove('dragging');
        tagline.classList.remove('dragging');
        primary.classList.remove('dragging');
        secondary.classList.remove('dragging');
        whatsapp.classList.remove('dragging');
      };
      window.addEventListener('pointerup', stop);
      window.addEventListener('pointercancel', stop);
    }

    function applyHeroCropFromConfig(value) {
      const { x, y } = parseHeroObjectPositionToXY(value);
      setHeroCrop(x, y, true);
    }

    function attachHeroCropperEvents() {
      const cropper = document.getElementById('heroCropper');
      const xInput = document.getElementById('heroCropX');
      const yInput = document.getElementById('heroCropY');
      const heroUrlInput = document.getElementById('settingHeroImage');
      if (!cropper || !xInput || !yInput) return;

      xInput.addEventListener('input', () => setHeroCrop(parseInt(xInput.value, 10), parseInt(yInput.value, 10), true));
      yInput.addEventListener('input', () => setHeroCrop(parseInt(xInput.value, 10), parseInt(yInput.value, 10), true));

      if (heroUrlInput) {
        heroUrlInput.addEventListener('change', () => syncHeroCropperImage());
        heroUrlInput.addEventListener('blur', () => syncHeroCropperImage());
      }

      let startX = 0;
      let startY = 0;
      let startPosX = 50;
      let startPosY = 50;
      let dragging = false;

      const getCurrentXY = () => {
        const x = parseInt(xInput.value, 10);
        const y = parseInt(yInput.value, 10);
        return { x: isNaN(x) ? 50 : x, y: isNaN(y) ? 50 : y };
      };

      const onDown = (clientX, clientY) => {
        dragging = true;
        cropper.classList.add('dragging');
        const cur = getCurrentXY();
        startPosX = cur.x;
        startPosY = cur.y;
        startX = clientX;
        startY = clientY;
      };

      const onMove = (clientX, clientY) => {
        if (!dragging) return;
        const rect = cropper.getBoundingClientRect();
        const dx = (clientX - startX) / rect.width;
        const dy = (clientY - startY) / rect.height;
        const nextX = clamp(startPosX - dx * 100, 0, 100);
        const nextY = clamp(startPosY - dy * 100, 0, 100);
        setHeroCrop(nextX, nextY, true);
      };

      const onUp = () => {
        dragging = false;
        cropper.classList.remove('dragging');
      };

      cropper.addEventListener('mousedown', (e) => {
        e.preventDefault();
        onDown(e.clientX, e.clientY);
      });
      window.addEventListener('mousemove', (e) => onMove(e.clientX, e.clientY));
      window.addEventListener('mouseup', () => onUp());

      cropper.addEventListener('touchstart', (e) => {
        if (!e.touches || e.touches.length !== 1) return;
        const t = e.touches[0];
        onDown(t.clientX, t.clientY);
      }, { passive: true });
      window.addEventListener('touchmove', (e) => {
        if (!e.touches || e.touches.length !== 1) return;
        const t = e.touches[0];
        onMove(t.clientX, t.clientY);
      }, { passive: true });
      window.addEventListener('touchend', () => onUp());
    }

    function updateHeroCropperVisibility() {
      const wrapper = document.getElementById('heroCropperWrapper');
      const mode = document.getElementById('settingHeroFitMode')?.value || 'cover';
      if (!wrapper) return;
      const hb = (typeof getHeroBackgroundFromUI === 'function') ? getHeroBackgroundFromUI() : { hasImage: true };
      if (!hb.hasImage) {
        wrapper.hidden = true;
        const hidden = document.getElementById('settingHeroObjectPosition');
        if (hidden) hidden.value = '';
        return;
      }
      if (mode === 'contain') {
        wrapper.hidden = true;
        // Crop focus isn't meaningful in contain mode; keep default.
        const hidden = document.getElementById('settingHeroObjectPosition');
        if (hidden) hidden.value = '';
      } else {
        wrapper.hidden = false;
      }
    }

    // ============================================================================
    // SUPER ADMIN FUNCTIONS
    // ============================================================================

    const ADMIN_TOKEN = 'webzyl-admin-dev-2026';

    async function resetWhatsAppQuota() {
      if (!confirm('Reset WhatsApp quota to 0 for this property?')) return;

      try {
        const response = await fetch('https://webzyl.com/api/admin/quota/reset', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'X-Admin-Token': ADMIN_TOKEN
          },
          body: JSON.stringify({
            slug: slug,
            quotaType: 'whatsapp'
          })
        });

        const result = await response.json();

        if (!response.ok) {
          throw new Error(result.error || 'Failed to reset quota');
        }

        alert('‚úÖ WhatsApp quota reset successfully!');

        // Reload config to show updated quota
        await loadPropertyConfig();
      } catch (error) {
        console.error('Reset quota error:', error);
        alert('‚ùå Failed to reset quota: ' + error.message);
      }
    }

    async function changeSlug() {
      const currentSlug = document.getElementById('settingSlug').value;
      const newSlug = prompt('Enter new slug (lowercase letters, numbers, hyphens only):', currentSlug);

      if (!newSlug || newSlug === currentSlug) return;

      if (!/^[a-z0-9-]+$/.test(newSlug)) {
        alert('‚ùå Invalid slug format. Use only lowercase letters, numbers, and hyphens.');
        return;
      }

      if (!confirm(`Change slug from "${currentSlug}" to "${newSlug}"?\n\n‚ö†Ô∏è This will change the property URL!\nOld: https://${currentSlug}.webzyl.com\nNew: https://${newSlug}.webzyl.com`)) {
        return;
      }

      try {
        const response = await fetch('https://webzyl.com/api/admin/config/change-slug', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'X-Admin-Token': ADMIN_TOKEN
          },
          body: JSON.stringify({
            oldSlug: currentSlug,
            newSlug: newSlug
          })
        });

        const result = await response.json();

        if (!response.ok) {
          throw new Error(result.error || 'Failed to change slug');
        }

        alert(`‚úÖ Slug changed successfully!\n\nOld: ${result.oldSlug}\nNew: ${result.newSlug}\n\nRedirecting to new URL...`);

        // Redirect to new slug
        window.location.href = `https://webzyl.com/operator?slug=${newSlug}`;
      } catch (error) {
        console.error('Change slug error:', error);

        let errorMsg = error.message;
        if (errorMsg === 'new_slug_already_exists') {
          errorMsg = 'This slug is already in use by another property';
        } else if (errorMsg === 'old_slug_not_found') {
          errorMsg = 'Current slug not found in database';
        }

        alert('‚ùå Failed to change slug: ' + errorMsg);
      }
    }

    // Initialize on page load
    window.addEventListener('DOMContentLoaded', () => {
      attachHeroCropperEvents();
      attachHeroTextPosEvents();
      initDashboard();
    });
  </script>
</body>
</html>
