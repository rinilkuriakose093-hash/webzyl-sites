<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>{{TITLE}}</title>
  <meta name="description" content="{{DESC}}">
  <meta property="og:title" content="{{TITLE}}">
  <meta property="og:description" content="{{DESC}}">
  <meta property="og:image" content="{{OG_IMAGE}}">
  <meta property="og:url" content="{{OG_URL}}">

  <!-- Tailwind (dev CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    :root {
      --accent: #b28700;
      --muted: #6b7280;
      --bg: #f7f7f8;
    }

    .hero-overlay {
      background: linear-gradient(180deg, rgba(255,255,255,0.0) 0%, rgba(255,255,255,0.62) 100%);
    }

    .focus-ring:focus { outline: 2px solid rgba(178,135,0,0.25); outline-offset: 3px; border-radius: 6px; }

    /* mobile nav helpers */
    .mobile-only { display: none; }
    @media (max-width: 767px) {
      .desktop-only { display: none !important; }
      .mobile-only { display: block !important; }
    }

    /* image safety */
    .img-safe { width:100%; height:100%; object-fit:cover; display:block; }

    /* small adjustments */
    .carousel-btn {
      background: rgba(255,255,255,0.85);
      padding: 8px;
      border-radius: 999px;
      box-shadow: 0 2px 6px rgba(20,20,20,0.06);
    }
  </style>
</head>
<body class="bg-[color:var(--bg)] text-slate-900 antialiased">

  <!-- Worker injects resort data here -->
  <script>
    {{DATA_INJECTION}}
  </script>

  <!-- HEADER -->
  <header class="bg-white shadow sticky top-0 z-50">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex items-center justify-between h-16">
      <div class="flex items-center gap-3">
        <img id="logo" class="h-10 w-10 rounded-md bg-gray-100 object-cover" alt="logo"/>
        <div class="leading-tight">
          <div id="site-name" class="text-base font-semibold"></div>
          <div id="tagline" class="text-xs text-slate-500"></div>
        </div>
      </div>

      <nav class="desktop-only flex items-center gap-6 text-sm">
        <a href="#rooms" class="text-slate-600 hover:text-slate-900">Rooms</a>
        <a href="#gallery" class="text-slate-600 hover:text-slate-900">Gallery</a>
        <a href="#booking" class="px-3 py-2 border border-[color:var(--accent)] text-[color:var(--accent)] rounded hover:bg-[color:var(--accent)] hover:text-white transition">Book Now</a>
      </nav>

      <button id="hamburger" class="mobile-only p-2 rounded-md focus-ring" aria-label="menu">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg>
      </button>
    </div>

    <!-- Mobile Panel -->
    <div id="mobile-nav-panel" class="mobile-only hidden border-t bg-white px-4 py-3">
      <div class="flex flex-col gap-3 text-sm">
        <a href="#rooms" class="text-slate-700">Rooms</a>
        <a href="#gallery" class="text-slate-700">Gallery</a>
        <a href="#booking" class="text-slate-700">Book Now</a>
      </div>
    </div>
  </header>

  <!-- HERO: full width, responsive height -->
  <main>
    <section id="hero" class="relative w-full min-h-[60vh] md:min-h-screen flex items-center justify-center overflow-hidden">
      <div id="hero-img" class="absolute inset-0 bg-center bg-cover"></div>
      <div class="absolute inset-0 hero-overlay"></div>

      <div class="relative z-10 px-4 text-center max-w-3xl">
        <h1 id="hero-title" class="text-3xl md:text-5xl font-extrabold leading-tight text-slate-900"></h1>
        <p id="hero-sub" class="mt-3 text-slate-700"></p>
        <div class="mt-6 flex justify-center gap-4">
          <a href="#booking" class="bg-[color:var(--accent)] text-white px-6 py-3 rounded-md font-semibold shadow">Reserve</a>
          <a id="hero-tour" class="text-[color:var(--accent)] underline hidden sm:inline-block">Virtual Tour</a>
        </div>
      </div>
    </section>

    <!-- Content container -->
    <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 -mt-10">

      <!-- About + Booking (stack on mobile) -->
      <section class="bg-white rounded-2xl p-6 shadow grid grid-cols-1 md:grid-cols-3 gap-6">
        <div class="md:col-span-2">
          <h2 class="text-2xl font-semibold">About</h2>
          <p id="about-text" class="mt-3 text-slate-700"></p>
          <div id="amenities" class="mt-4 flex flex-wrap gap-2"></div>
        </div>

        <aside id="booking" class="bg-gray-50 p-4 rounded-lg">
          <h3 class="font-semibold">Book Your Stay</h3>
          <form id="booking-form" class="mt-3 grid gap-3">
            <input name="slug" type="hidden" />
            <input name="name" placeholder="Guest name" required class="p-3 rounded border border-gray-200 focus-ring" />
            <input name="phone" placeholder="Phone" required class="p-3 rounded border border-gray-200 focus-ring" />
            <select id="room-select" name="roomType" class="p-3 rounded border border-gray-200 focus-ring"></select>
            <div class="grid grid-cols-2 gap-2">
              <input name="checkIn" type="date" class="p-3 rounded border border-gray-200 focus-ring" />
              <input name="checkOut" type="date" class="p-3 rounded border border-gray-200 focus-ring" />
            </div>
            <button class="bg-[color:var(--accent)] text-white py-3 rounded font-semibold">Send Request</button>
            <p id="booking-status" class="text-sm text-slate-500"></p>
          </form>
        </aside>
      </section>

      <!-- Rooms -->
      <section id="rooms" class="mt-8">
        <h3 class="text-xl font-semibold">Rooms</h3>
        <div id="rooms-grid" class="mt-4 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6"></div>
      </section>

      <!-- Gallery -->
      <section id="gallery" class="mt-8">
        <h3 class="text-xl font-semibold">Gallery</h3>
        <div class="relative mt-4">
          <div id="carousel" class="overflow-hidden rounded-xl bg-white">
            <div id="slides" class="whitespace-nowrap transition-transform duration-500"></div>
          </div>
          <button id="prev" class="absolute left-4 top-1/2 -translate-y-1/2 carousel-btn">‹</button>
          <button id="next" class="absolute right-4 top-1/2 -translate-y-1/2 carousel-btn">›</button>
        </div>
      </section>

      <!-- Location & Contact -->
      <section class="mt-8 grid md:grid-cols-2 gap-6 mb-16">
        <div>
          <h4 class="text-lg font-semibold">Location</h4>
          <div id="map" class="mt-3 h-64 rounded-xl bg-gray-100 overflow-hidden"></div>
        </div>
        <div class="bg-white p-6 rounded-xl shadow">
          <h4 class="font-semibold">Contact</h4>
          <p id="contact" class="mt-3 text-slate-700"></p>
        </div>
      </section>

      <footer class="text-center py-8 text-sm text-slate-500">
        © <span id="year"></span> <span id="fn"></span>
      </footer>
    </div>
  </main>

  <!-- HYDRATION SCRIPT (correct DOM handling) -->
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      try {
        const cfg = window.RESORT_DATA || {};

        // Header
        const logoEl = document.getElementById('logo');
        if (logoEl) logoEl.src = cfg.branding?.logo || '';
        const siteNameEl = document.getElementById('site-name');
        if (siteNameEl) siteNameEl.textContent = cfg.name || '{{TITLE}}';
        const taglineEl = document.getElementById('tagline');
        if (taglineEl) taglineEl.textContent = cfg.tagline || '';

        // Hero
        const heroTitleEl = document.getElementById('hero-title');
        if (heroTitleEl) heroTitleEl.textContent = cfg.name || '';
        const heroSubEl = document.getElementById('hero-sub');
        if (heroSubEl) heroSubEl.textContent = cfg.tagline || '';

        const heroImgEl = document.getElementById('hero-img');
        if (heroImgEl && cfg.branding?.heroImage) {
          let url = cfg.branding.heroImage;
          if (!url.includes('?')) url += '?auto=format&fit=crop&w=1600&q=80';
          heroImgEl.style.backgroundImage = `url('${url}')`;
          heroImgEl.style.backgroundSize = 'cover';
          heroImgEl.style.backgroundPosition = 'center';
        }

        // About
        const aboutEl = document.getElementById('about-text');
        if (aboutEl) aboutEl.textContent = cfg.about || '';

        // Amenities
        const amEl = document.getElementById('amenities');
        if (amEl) {
          (cfg.amenities || []).forEach(a => {
            const s = document.createElement('span');
            s.className = 'px-3 py-1 bg-gray-100 text-sm rounded';
            s.textContent = a;
            amEl.appendChild(s);
          });
        }

        // Rooms
        const roomsGrid = document.getElementById('rooms-grid');
        const roomSelect = document.getElementById('room-select');
        if (roomsGrid && Array.isArray(cfg.rooms)) {
          cfg.rooms.forEach((r, i) => {
            const card = document.createElement('article');
            card.className = 'bg-white rounded-xl shadow overflow-hidden';

            const imgWrap = document.createElement('div');
            imgWrap.className = 'w-full h-48 bg-gray-100 overflow-hidden';

            const img = document.createElement('img');
            let imgUrl = r.image || '';
            if (imgUrl && !imgUrl.includes('?')) imgUrl += '?auto=format&fit=crop&w=1200&q=80';
            img.src = imgUrl;
            img.alt = r.name || ('Room ' + (i + 1));
            img.loading = 'lazy';
            img.className = 'img-safe';
            imgWrap.appendChild(img);

            const box = document.createElement('div');
            box.className = 'p-4';

            const title = document.createElement('h4');
            title.className = 'font-semibold';
            title.textContent = r.name || '';

            const price = document.createElement('div');
            price.className = 'text-[color:var(--accent)] font-semibold mt-1';
            price.textContent = r.price || '';

            const desc = document.createElement('p');
            desc.className = 'text-sm text-slate-600 mt-2';
            desc.textContent = r.description || '';

            box.appendChild(title);
            box.appendChild(price);
            box.appendChild(desc);

            card.appendChild(imgWrap);
            card.appendChild(box);

            roomsGrid.appendChild(card);

            if (roomSelect) {
              const opt = document.createElement('option');
              opt.value = r.name || '';
              opt.textContent = `${r.name || ''} — ${r.price || ''}`;
              roomSelect.appendChild(opt);
            }
          });
        }

        // Gallery carousel
        const slidesEl = document.getElementById('slides');
        if (slidesEl && Array.isArray(cfg.gallery)) {
          cfg.gallery.forEach(url => {
            let u = url;
            if (!u.includes('?')) u += '?auto=format&fit=crop&w=1200&q=80';
            const outer = document.createElement('div');
            outer.className = 'inline-block w-full align-top';
            outer.innerHTML = `<img src="${u}" class="w-full h-64 object-cover rounded-xl" loading="lazy" alt="gallery">`;
            slidesEl.appendChild(outer);
          });
        }

        // Carousel controls
        let idx = 0;
        const total = Math.max(1, (document.getElementById('slides')?.children.length || 1));
        const slides = document.getElementById('slides');
        function update() {
          if (slides) slides.style.transform = `translateX(-${idx * 100}%)`;
        }
        const nextBtn = document.getElementById('next');
        const prevBtn = document.getElementById('prev');
        if (nextBtn) nextBtn.addEventListener('click', () => { idx = (idx + 1) % total; update(); });
        if (prevBtn) prevBtn.addEventListener('click', () => { idx = (idx - 1 + total) % total; update(); });

        // Map
        const mapEl = document.getElementById('map');
        if (mapEl && cfg.embeds?.map) {
          mapEl.innerHTML = `<iframe class="w-full h-full border-0" src="${cfg.embeds.map}" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>`;
        }

        // Contact
        const contactEl = document.getElementById('contact');
        if (contactEl) contactEl.textContent = cfg.contact?.phone ? `Phone: ${cfg.contact.phone}` : '';

        // Booking
        const bookingForm = document.getElementById('booking-form');
        const bookingStatusEl = document.getElementById('booking-status');
        if (bookingForm) {
          bookingForm.querySelector('[name="slug"]').value = cfg.slug || '';
          bookingForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            if (bookingStatusEl) bookingStatusEl.textContent = 'Sending...';
            const data = Object.fromEntries(new FormData(bookingForm));
            try {
              const res = await fetch('/api/booking', {
                method: 'POST',
                headers: { 'content-type': 'application/json' },
                body: JSON.stringify(data)
              });
              const out = await res.json();
              if (bookingStatusEl) bookingStatusEl.textContent = out.success ? 'Request sent' : (out.error || 'Failed');
            } catch (err) {
              if (bookingStatusEl) bookingStatusEl.textContent = 'Network error';
            }
          });
        }

        // Mobile nav toggle
        const ham = document.getElementById('hamburger');
        const mobilePanel = document.getElementById('mobile-nav-panel');
        if (ham && mobilePanel) {
          ham.addEventListener('click', () => mobilePanel.classList.toggle('hidden'));
        }

        // Footer
        const yearEl = document.getElementById('year');
        if (yearEl) yearEl.textContent = new Date().getFullYear();
        const fnEl = document.getElementById('fn');
        if (fnEl) fnEl.textContent = cfg.name || '';

        // ensure initial carousel position
        update();
      } catch (e) {
        // avoid visible crash; log to console for dev
        console.error('hydration error', e);
      }
    });
  </script>
</body>
</html>
