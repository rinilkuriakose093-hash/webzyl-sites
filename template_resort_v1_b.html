<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />

  <title>{{TITLE}}</title>
  <meta name="description" content="{{DESC}}">
  <meta property="og:title" content="{{TITLE}}">
  <meta property="og:description" content="{{DESC}}">
  <meta property="og:image" content="{{OG_IMAGE}}">
  <meta property="og:url" content="{{OG_URL}}">

  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    :root { --accent: #b28700; }
    .carousel-btn {
      background: rgba(0,0,0,0.45);
      padding: 8px;
      border-radius: 999px;
      color: white;
      cursor: pointer;
    }
  </style>
</head>

<body class="bg-slate-900 text-white antialiased">

  <!-- DATA INJECTED BY WORKER -->
  <script>
    {{DATA_INJECTION}}
  </script>

  <!-- NAVIGATION -->
  <nav class="max-w-7xl mx-auto px-6 py-5 flex items-center justify-between">
    <div class="flex items-center gap-4">
      <img id="logo" class="h-12 w-12 rounded" src="" alt="logo"/>
      <div>
        <h1 id="site-name" class="font-bold text-lg"></h1>
        <p id="tagline" class="text-sm text-slate-300"></p>
      </div>
    </div>
    <div class="flex items-center gap-3">
      <a href="#rooms" class="text-slate-300 hover:text-white">Rooms</a>
      <a href="#gallery" class="text-slate-300 hover:text-white">Gallery</a>
      <a href="#booking" class="ml-3 px-4 py-2 border border-yellow-500 text-yellow-300 rounded">
        Book Now
      </a>
    </div>
  </nav>

  <!-- HERO SECTION -->
  <header class="relative overflow-hidden">
    <div id="hero-img" class="h-[60vh] bg-cover bg-center" style="background-image:url('')"></div>

    <div class="absolute inset-0 flex items-center justify-center">
      <div class="text-center px-4">
        <h2 id="hero-title" class="text-4xl md:text-6xl font-extrabold drop-shadow-lg"></h2>
        <p id="hero-sub" class="mt-3 text-slate-200 max-w-2xl mx-auto"></p>

        <div class="mt-6 flex justify-center gap-3">
          <a href="#booking" class="bg-yellow-500 text-slate-900 px-6 py-3 rounded font-semibold">
            Reserve
          </a>
          <a class="text-yellow-300 underline cursor-pointer">Virtual Tour</a>
        </div>
      </div>
    </div>
  </header>

  <!-- MAIN BODY -->
  <main class="max-w-6xl mx-auto px-6 -mt-20">

    <!-- ABOUT + AMENITIES -->
    <section class="bg-white/5 backdrop-blur-md p-6 rounded-lg shadow-lg border border-white/10">
      <div class="flex flex-col md:flex-row gap-6">
        
        <!-- ABOUT -->
        <div class="md:w-2/3">
          <h3 class="text-2xl font-semibold">About</h3>
          <p id="about-text" class="mt-3 text-slate-200"></p>

          <div id="amenities" class="mt-4 flex gap-3 flex-wrap"></div>
        </div>

        <!-- BOOKING BOX -->
        <aside class="md:w-1/3 bg-slate-800 p-4 rounded">
          <h4 class="font-semibold">Book Your Stay</h4>

          <form id="booking-form" class="mt-3 grid gap-3">
            <input name="slug" type="hidden" />

            <input name="name" required placeholder="Guest name"
              class="p-2 rounded bg-black/20" />

            <input name="phone" required placeholder="Phone"
              class="p-2 rounded bg-black/20" />

            <select name="roomType" id="room-select"
              class="p-2 rounded bg-black/20"></select>

            <div class="flex gap-2">
              <input name="checkIn" type="date" class="p-2 rounded bg-black/20" />
              <input name="checkOut" type="date" class="p-2 rounded bg-black/20" />
            </div>

            <button class="bg-yellow-500 text-black py-2 rounded font-semibold">
              Send Request
            </button>

            <p id="booking-status" class="text-sm text-slate-300"></p>
          </form>
        </aside>

      </div>
    </section>

    <!-- ROOMS -->
    <section id="rooms" class="mt-10">
      <h4 class="text-xl font-semibold">Rooms</h4>

      <div id="rooms-grid"
        class="mt-4 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
      </div>
    </section>

    <!-- GALLERY CAROUSEL -->
    <section id="gallery" class="mt-10">
      <h4 class="text-xl font-semibold">Gallery</h4>

      <div class="relative mt-4">
        <div id="carousel" class="overflow-hidden rounded-lg">
          <div id="slides" class="whitespace-nowrap transition-transform duration-500"></div>
        </div>

        <button id="prev" class="carousel-btn absolute left-4 top-1/2 -translate-y-1/2">‹</button>
        <button id="next" class="carousel-btn absolute right-4 top-1/2 -translate-y-1/2">›</button>
      </div>
    </section>

    <!-- LOCATION + CONTACT -->
    <section class="mt-10 grid md:grid-cols-2 gap-6">

      <div>
        <h4 class="text-xl font-semibold">Location</h4>
        <div id="map" class="mt-3 h-64 rounded bg-black/20"></div>
      </div>

      <div class="bg-slate-800 p-4 rounded">
        <h4 class="font-semibold">Contact</h4>
        <p id="contact" class="mt-2 text-slate-300"></p>
      </div>
    </section>

    <!-- FOOTER -->
    <footer class="mt-12 text-center text-slate-400 py-8">
      © <span id="year"></span> <span id="fn"></span>
    </footer>

  </main>

  <!-- DYNAMIC JS HYDRATION -->
  <script>
    (function() {
      const cfg = window.RESORT_DATA || {};

      // HEADER
      document.getElementById("logo").src = cfg?.branding?.logo || "";
      document.getElementById("site-name").textContent = cfg?.name || "";
      document.getElementById("tagline").textContent = cfg?.tagline || "";

      // HERO
      document.getElementById("hero-title").textContent = cfg?.name || "";
      document.getElementById("hero-sub").textContent = cfg?.tagline || "";
      document.getElementById("hero-img").style.backgroundImage =
        `url('${cfg?.branding?.heroImage || ""}')`;

      // ABOUT
      document.getElementById("about-text").textContent = cfg?.about || "";

      // AMENITIES
      const am = document.getElementById("amenities");
      (cfg?.amenities || []).forEach(a => {
        const item = document.createElement("span");
        item.className = "px-3 py-1 rounded bg-white/10 text-sm";
        item.textContent = a;
        am.appendChild(item);
      });

      // ROOMS
      const rooms = document.getElementById("rooms-grid");
      (cfg?.rooms || []).forEach(r => {
        const div = document.createElement("div");
        div.className = "bg-slate-800 p-4 rounded";

        div.innerHTML = `
          <img src="${r.image}" class="w-full h-44 object-cover rounded mb-3">
          <h5 class="font-semibold">${r.name}</h5>
          <div class="mt-2 text-yellow-300 font-bold">${r.price}</div>
          <p class="mt-2 text-slate-300 text-sm">${r.description}</p>
        `;

        rooms.appendChild(div);

        // Add to booking dropdown
        const opt = document.createElement("option");
        opt.value = r.name;
        opt.textContent = `${r.name} — ${r.price}`;
        document.getElementById("room-select").appendChild(opt);
      });

      // GALLERY
      const slides = document.getElementById("slides");
      (cfg?.gallery || []).forEach(img => {
        const item = document.createElement("div");
        item.className = "inline-block w-full";
        item.innerHTML = `<img src="${img}" class="w-full h-72 object-cover">`;
        slides.appendChild(item);
      });

      let idx = 0;
      const total = slides.children.length;
      function updateSlide() {
        slides.style.transform = `translateX(-${idx * 100}%)`;
      }
      document.getElementById("next").onclick = () => {
        idx = (idx + 1) % total;
        updateSlide();
      };
      document.getElementById("prev").onclick = () => {
        idx = (idx - 1 + total) % total;
        updateSlide();
      };

      // MAP
      if (cfg?.embeds?.map) {
        document.getElementById("map").innerHTML =
          `<iframe class="w-full h-64" src="${cfg.embeds.map}" loading="lazy"></iframe>`;
      }

      // CONTACT
      document.getElementById("contact").textContent =
        cfg?.contact?.phone ? `Phone: ${cfg.contact.phone}` : "";

      // BOOKING FORM
      const form = document.getElementById("booking-form");
      form.slug.value = cfg.slug;

      form.addEventListener("submit", async (e) => {
        e.preventDefault();
        const fd = new FormData(form);
        const body = {};
        fd.forEach((v, k) => body[k] = v);
        
        document.getElementById("booking-status").textContent = "Sending...";

        const res = await fetch("/api/booking", {
          method: "POST",
          headers: { "content-type": "application/json" },
          body: JSON.stringify(body)
        });

        const out = await res.json();
        document.getElementById("booking-status").textContent =
          out.success ? "Booking request sent!" : ("Error: " + out.error);
      });

      // FOOTER
      document.getElementById("year").textContent =
        new Date().getFullYear();
      document.getElementById("fn").textContent = cfg?.name || "";

    })();
  </script>

</body>
</html>
